<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Line Free India - Enterprise</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#000000',
                        surface: '#0F0F0F',
                        surfaceLight: '#1A1A1A',
                        surfaceLighter: '#2A2A2A',
                        gold: '#D4AF37', 
                        goldDim: '#8A7030',
                        goldLight: '#F3E5AB',
                        accent: '#3B82F6',
                        danger: '#EF4444',
                        success: '#10B981',
                        textMain: '#FFFFFF',
                        textSec: '#9CA3AF',
                        textTert: '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    animation: {
                        'pulse-glow': 'pulseGlow 3s infinite',
                        'slide-up': 'slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px rgba(212, 175, 55, 0.1)' }, '50%': { boxShadow: '0 0 25px rgba(212, 175, 55, 0.3)' } },
                        slideUp: { '0%': { transform: 'translateY(100%)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } }
                    }
                }
            }
        }
    </script>
    
    <!-- Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #000000; color: #ffffff; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .glass { background: rgba(20, 20, 20, 0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-heavy { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #AA8929 100%); }
        .text-gradient { background: linear-gradient(to right, #D4AF37, #F3E5AB); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Preloader */
        #preloader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-col; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .spinner { width: 50px; height: 50px; border: 3px solid rgba(212, 175, 55, 0.3); border-radius: 50%; border-top-color: #D4AF37; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="preloader">
        <div class="spinner mb-4"></div>
        <div class="text-gold text-xs font-bold tracking-[0.3em] uppercase animate-pulse">Initializing System</div>
    </div>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, getDoc, setDoc, addDoc, onSnapshot, query, where, orderBy, updateDoc, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBYJq8T7hMP3OsZ0PYqkWe-dDCWB8_b0Ck",
            authDomain: "line-free-4bb96.firebaseapp.com",
            projectId: "line-free-4bb96",
            storageBucket: "line-free-4bb96.firebasestorage.app",
            messagingSenderId: "137966607796",
            appId: "1:137966607796:web:bc84b4884650911d9ea6e1",
            measurementId: "G-6Z6YQ8Z6CC"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        const { useState, useEffect, useRef, useMemo } = React;

        // --- UTILITY COMPONENTS ---

        const Icon = ({ name, size = 20, className, fill }) => {
            return <i data-lucide={name} width={size} height={size} className={className} fill={fill}></i>;
        };

        const BottomNav = ({ tabs, activeTab, onTabChange }) => (
            <div className="fixed bottom-0 left-0 w-full glass-heavy pb-6 pt-3 px-6 flex justify-between items-center z-40">
                {tabs.map((tab) => (
                    <button
                        key={tab.id}
                        onClick={() => onTabChange(tab.id)}
                        className={`flex flex-col items-center gap-1 transition-all duration-300 ${activeTab === tab.id ? 'text-gold scale-110' : 'text-textSec hover:text-white'}`}
                    >
                        <Icon name={tab.icon} size={24} fill={activeTab === tab.id && tab.fill ? "currentColor" : "none"} />
                        <span className="text-[10px] font-medium tracking-wide">{tab.label}</span>
                    </button>
                ))}
            </div>
        );

        const Header = ({ title, subtitle, action }) => (
            <div className="pt-6 pb-4 px-6 bg-gradient-to-b from-black via-black to-transparent sticky top-0 z-30">
                <div className="flex justify-between items-center">
                    <div>
                        <h1 className="text-2xl font-bold text-white tracking-tight">{title}</h1>
                        {subtitle && <p className="text-xs text-textSec mt-0.5">{subtitle}</p>}
                    </div>
                    {action}
                </div>
            </div>
        );

        const Card = ({ children, className = "" }) => (
            <div className={`bg-surfaceLight border border-white/5 p-4 rounded-2xl ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, variant = 'primary', className = "", disabled=false }) => {
            const baseClass = "w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-gold text-black hover:bg-white",
                secondary: "bg-surfaceLight text-white border border-white/10 hover:border-gold/30",
                danger: "bg-danger/10 text-danger border border-danger/20 hover:bg-danger hover:text-white",
                ghost: "bg-transparent text-textSec hover:text-white"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseClass} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // --- SPLASH SCREEN ---
        const SplashScreen = ({ onFinish }) => {
            useEffect(() => {
                lucide.createIcons();
                setTimeout(onFinish, 2500);
            }, []);

            return (
                <div className="fixed inset-0 z-50 bg-bg flex flex-col items-center justify-center overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                    <div className="absolute top-[-20%] left-[-20%] w-[140%] h-[140%] bg-[radial-gradient(circle_at_center,_rgba(212,175,55,0.15),transparent_70%)] animate-pulse-glow"></div>
                    
                    <div className="relative z-10 mb-8">
                         <div className="w-28 h-28 rounded-3xl glass border border-gold/30 flex items-center justify-center shadow-[0_0_40px_rgba(212,175,55,0.2)]">
                            <Icon name="scissors" size={60} className="text-gold" />
                        </div>
                    </div>
                    
                    <h1 className="relative z-10 text-5xl font-black text-white tracking-tighter">
                        LINE <span className="text-gradient">FREE</span>
                    </h1>
                    <div className="relative z-10 flex items-center gap-3 mt-4 px-4 py-2 rounded-full glass border border-white/5">
                        <div className="w-2 h-2 rounded-full bg-success animate-pulse"></div>
                        <span className="text-[10px] font-bold uppercase tracking-widest text-textSec">India's #1 Salon OS</span>
                    </div>
                </div>
            );
        };

        // --- AUTH & ONBOARDING ---
        const LoginScreen = ({ onLogin }) => {
            useEffect(() => lucide.createIcons(), []);
            return (
                <div className="min-h-screen bg-bg flex flex-col relative overflow-hidden">
                    {/* Background Art */}
                    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=800&q=80')] bg-cover bg-center opacity-20 grayscale"></div>
                    <div className="absolute inset-0 bg-gradient-to-t from-black via-black to-transparent"></div>

                    <div className="flex-1 flex flex-col justify-end p-8 relative z-10 pb-16">
                        <div className="mb-8">
                             <div className="inline-flex p-3 rounded-xl bg-surfaceLight border border-gold/20 mb-6">
                                <Icon name="crown" size={24} className="text-gold" />
                            </div>
                            <h1 className="text-5xl font-bold text-white leading-[1.1] mb-4">
                                Premium <br/>
                                <span className="text-gradient">Experiences.</span>
                            </h1>
                            <p className="text-textSec text-lg font-light leading-relaxed">
                                Join the elite network of salons. Manage queues, staff, and revenue with intelligence.
                            </p>
                        </div>

                        <Button onClick={onLogin} className="mb-4">
                            <Icon name="log-in" size={20} /> Continue with Google
                        </Button>
                        <p className="text-center text-[10px] text-textTert">By continuing you agree to Terms & Privacy Policy.</p>
                    </div>
                </div>
            );
        };

        const RoleSelection = ({ onSelect }) => {
            useEffect(() => lucide.createIcons(), []);
            return (
                <div className="min-h-screen bg-bg p-6 pt-20 animate-fade-in">
                    <h2 className="text-3xl font-bold text-white mb-2">Select Profile</h2>
                    <p className="text-textSec mb-10">How will you use Line Free India?</p>

                    <div className="grid gap-6">
                        {/* Customer Option */}
                        <div onClick={() => onSelect('customer')} className="group bg-surfaceLight p-1 rounded-3xl cursor-pointer transition-all hover:scale-[1.02]">
                            <div className="bg-bg rounded-[20px] p-6 border border-white/5 group-hover:border-gold/50 h-full relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-10 transition-opacity"><Icon name="user" size={120}/></div>
                                <div className="w-14 h-14 rounded-full bg-surfaceLight border border-white/10 flex items-center justify-center mb-4 text-white group-hover:text-gold transition-colors">
                                    <Icon name="user" size={24} />
                                </div>
                                <h3 className="text-xl font-bold text-white">Customer</h3>
                                <p className="text-textSec text-sm mt-2">Book appointments, skip queues, and find top-rated salons nearby.</p>
                            </div>
                        </div>

                        {/* Owner Option */}
                        <div onClick={() => onSelect('owner')} className="group bg-surfaceLight p-1 rounded-3xl cursor-pointer transition-all hover:scale-[1.02]">
                             <div className="bg-bg rounded-[20px] p-6 border border-white/5 group-hover:border-gold/50 h-full relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-10 transition-opacity"><Icon name="store" size={120}/></div>
                                <div className="w-14 h-14 rounded-full bg-surfaceLight border border-white/10 flex items-center justify-center mb-4 text-white group-hover:text-gold transition-colors">
                                    <Icon name="briefcase" size={24} />
                                </div>
                                <h3 className="text-xl font-bold text-white">Salon Partner</h3>
                                <p className="text-textSec text-sm mt-2">Manage your business, staff, analytics, and grow your revenue.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- OWNER DASHBOARD SUB-COMPONENTS ---

        const OwnerHome = ({ salon, queue, toggleStatus, callNext }) => {
             // Calculate Stats
             const waitingCount = queue.filter(t => t.status === 'waiting').length;
             const completedCount = queue.filter(t => t.status === 'completed').length; // Mock
             const currentToken = queue.find(t => t.status === 'serving');

             return (
                 <div className="p-6 space-y-6 pb-24 animate-slide-up">
                    {/* Status Header */}
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className={`w-3 h-3 rounded-full ${salon?.status === 'open' ? 'bg-success animate-pulse' : 'bg-danger'}`}></div>
                            <span className="text-sm font-bold uppercase tracking-wider text-textSec">{salon?.status || 'Unknown'}</span>
                        </div>
                        <button onClick={toggleStatus} className={`px-4 py-2 rounded-full text-xs font-bold border transition-colors ${salon?.status === 'open' ? 'border-danger/30 text-danger hover:bg-danger/10' : 'border-success/30 text-success hover:bg-success/10'}`}>
                            {salon?.status === 'open' ? 'Close Shop' : 'Go Online'}
                        </button>
                    </div>

                    {/* Revenue Card */}
                    <div className="bg-gradient-to-br from-surfaceLight to-black p-6 rounded-3xl border border-white/5 relative overflow-hidden">
                        <div className="absolute right-0 bottom-0 p-4 opacity-10"><Icon name="trending-up" size={100} /></div>
                        <div className="relative z-10">
                            <p className="text-gold text-xs font-bold uppercase tracking-widest mb-2">Today's Revenue</p>
                            <h2 className="text-4xl font-bold text-white flex items-center gap-2">
                                <span className="text-2xl text-textSec">â‚¹</span> {salon?.revenue || 0}
                            </h2>
                            <div className="mt-4 flex gap-2">
                                <span className="text-xs bg-success/10 text-success px-2 py-1 rounded flex items-center gap-1"><Icon name="arrow-up" size={10} /> 12%</span>
                                <span className="text-xs text-textSec py-1">vs yesterday</span>
                            </div>
                        </div>
                    </div>

                    {/* Active Customer */}
                    <div className="bg-gold p-6 rounded-3xl text-black shadow-lg shadow-gold/10">
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <p className="text-xs font-bold uppercase opacity-60 mb-1">Serving Now</p>
                                <h3 className="text-2xl font-bold">{currentToken ? currentToken.customerName : 'Waiting...'}</h3>
                                <p className="text-sm opacity-80">{currentToken ? `Token #${currentToken.tokenNumber}` : 'Queue Empty'}</p>
                            </div>
                            <div className="w-10 h-10 rounded-full bg-black/10 flex items-center justify-center">
                                <Icon name="user" size={20} className="text-black" />
                            </div>
                        </div>
                        <Button onClick={callNext} disabled={!queue.some(t => t.status === 'waiting')} className="bg-black text-white hover:bg-gray-800 border-none w-full">
                            Call Next Customer <Icon name="arrow-right" size={18} />
                        </Button>
                    </div>

                    {/* Quick Stats Grid */}
                    <div className="grid grid-cols-2 gap-4">
                        <Card className="text-center py-6">
                            <div className="text-3xl font-bold text-white mb-1">{waitingCount}</div>
                            <div className="text-xs text-textSec uppercase">In Queue</div>
                        </Card>
                        <Card className="text-center py-6">
                            <div className="text-3xl font-bold text-gold">{completedCount}</div>
                            <div className="text-xs text-textSec uppercase">Completed</div>
                        </Card>
                    </div>
                 </div>
             );
        };

        const OwnerServices = ({ salon, user, onUpdate }) => {
            const [services, setServices] = useState(salon?.services || []);
            const [newName, setNewName] = useState('');
            const [newPrice, setNewPrice] = useState('');
            const [isAdding, setIsAdding] = useState(false);

            const addService = async () => {
                if(!newName || !newPrice) return;
                const updated = [...services, { id: Date.now(), name: newName, price: parseInt(newPrice), time: 30 }];
                await updateDoc(doc(db, "salons", user.uid), { services: updated });
                setServices(updated);
                setNewName(''); setNewPrice(''); setIsAdding(false);
            };

            const removeService = async (id) => {
                const updated = services.filter(s => s.id !== id);
                await updateDoc(doc(db, "salons", user.uid), { services: updated });
                setServices(updated);
            }

            return (
                <div className="p-6 pb-24 animate-slide-up">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold text-white">Menu & Pricing</h2>
                        <button onClick={() => setIsAdding(!isAdding)} className="w-10 h-10 rounded-xl bg-surfaceLight border border-white/10 flex items-center justify-center text-gold hover:bg-gold hover:text-black transition-colors">
                            <Icon name={isAdding ? "x" : "plus"} />
                        </button>
                    </div>

                    {isAdding && (
                        <Card className="mb-6 border-gold/30">
                            <h3 className="text-sm font-bold text-white mb-4">Add New Service</h3>
                            <div className="space-y-3">
                                <input value={newName} onChange={e=>setNewName(e.target.value)} placeholder="Service Name (e.g. Haircut)" className="w-full bg-bg border border-white/10 rounded-xl p-3 text-sm text-white focus:border-gold outline-none" />
                                <div className="flex gap-3">
                                    <input value={newPrice} onChange={e=>setNewPrice(e.target.value)} type="number" placeholder="Price (â‚¹)" className="flex-1 bg-bg border border-white/10 rounded-xl p-3 text-sm text-white focus:border-gold outline-none" />
                                    <Button onClick={addService} className="flex-1 py-3 text-sm">Add</Button>
                                </div>
                            </div>
                        </Card>
                    )}

                    <div className="space-y-3">
                        {services.map(s => (
                            <div key={s.id} className="flex justify-between items-center bg-surfaceLight p-4 rounded-2xl border border-white/5">
                                <div>
                                    <h4 className="font-bold text-white">{s.name}</h4>
                                    <p className="text-xs text-textSec">30 mins</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <span className="font-bold text-gold">â‚¹{s.price}</span>
                                    <button onClick={() => removeService(s.id)} className="text-danger opacity-50 hover:opacity-100"><Icon name="trash-2" size={18} /></button>
                                </div>
                            </div>
                        ))}
                        {services.length === 0 && <div className="text-center text-textSec py-10">No services added yet.</div>}
                    </div>
                </div>
            );
        };

        const OwnerQR = ({ user }) => {
            const qrRef = useRef(null);
            
            useEffect(() => {
                if (qrRef.current) {
                    qrRef.current.innerHTML = "";
                    new QRCode(qrRef.current, {
                        text: `https://linefree.app/salon/${user.uid}`,
                        width: 256,
                        height: 256,
                        colorDark : "#000000",
                        colorLight : "#ffffff",
                        correctLevel : QRCode.CorrectLevel.H
                    });
                }
            }, []);

            return (
                <div className="p-6 pb-24 flex flex-col items-center justify-center min-h-[70vh] animate-slide-up">
                    <Card className="p-8 bg-white flex flex-col items-center shadow-2xl shadow-white/10">
                        <div ref={qrRef} className="mb-6"></div>
                        <h3 className="text-black font-bold text-xl mb-2">Scan to Join Queue</h3>
                        <p className="text-gray-500 text-xs text-center max-w-[200px]">Customers can scan this code to book an appointment instantly.</p>
                    </Card>
                    <Button variant="secondary" className="mt-8 max-w-xs" onClick={() => window.print()}><Icon name="printer" size={18} /> Print QR Code</Button>
                </div>
            );
        };

        const OwnerSettings = ({ user, salon }) => {
            const [name, setName] = useState(salon?.shopName || '');
            const [addr, setAddr] = useState(salon?.address || '');

            const save = async () => {
                await updateDoc(doc(db, "salons", user.uid), { shopName: name, address: addr });
                alert("Settings Saved");
            };

            return (
                <div className="p-6 pb-24 animate-slide-up">
                    <h2 className="text-xl font-bold text-white mb-6">Business Settings</h2>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs text-textSec uppercase">Shop Name</label>
                            <input value={name} onChange={e=>setName(e.target.value)} className="w-full bg-surfaceLight border border-white/10 rounded-xl p-4 mt-1 text-white outline-none focus:border-gold" />
                        </div>
                        <div>
                            <label className="text-xs text-textSec uppercase">Address</label>
                            <input value={addr} onChange={e=>setAddr(e.target.value)} className="w-full bg-surfaceLight border border-white/10 rounded-xl p-4 mt-1 text-white outline-none focus:border-gold" />
                        </div>
                        <Button onClick={save}>Save Changes</Button>
                        <Button onClick={() => auth.signOut()} variant="danger" className="mt-8">Sign Out</Button>
                    </div>
                </div>
            );
        };

        // --- CUSTOMER DASHBOARD SUB-COMPONENTS ---

        const CustomerHome = ({ user, salons, onBook }) => {
             return (
                 <div className="p-6 pb-24 animate-slide-up">
                    {/* Welcome */}
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h1 className="text-2xl font-bold text-white">Hello, {user.displayName?.split(' ')[0]} ðŸ‘‹</h1>
                            <p className="text-textSec text-sm">Find the best look for you.</p>
                        </div>
                        <div className="w-10 h-10 rounded-full border border-gold/30 p-0.5">
                            <img src={user.photoURL} className="w-full h-full rounded-full" />
                        </div>
                    </div>

                    {/* Search Bar */}
                    <div className="relative mb-8">
                        <Icon name="search" className="absolute left-4 top-3.5 text-textSec" size={20} />
                        <input placeholder="Search salons, services..." className="w-full bg-surfaceLight border border-white/5 rounded-2xl py-3 pl-12 pr-4 text-white focus:border-gold/50 outline-none transition-all placeholder:text-textSec/50" />
                    </div>

                    {/* Featured Categories */}
                    <div className="flex gap-4 overflow-x-auto no-scrollbar mb-8">
                        {['All', 'Haircut', 'Spa', 'Beard', 'Color'].map((cat, i) => (
                            <button key={cat} className={`px-5 py-2.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors border ${i===0 ? 'bg-gold border-gold text-black' : 'bg-surfaceLight border-white/5 text-textSec hover:border-gold/30 hover:text-white'}`}>
                                {cat}
                            </button>
                        ))}
                    </div>

                    {/* Nearby Salons */}
                    <h2 className="text-lg font-bold text-white mb-4">Recommended Nearby</h2>
                    <div className="space-y-4">
                        {salons.map(salon => (
                            <div key={salon.id} onClick={() => onBook(salon)} className="group bg-surfaceLight rounded-3xl p-4 border border-white/5 cursor-pointer hover:border-gold/30 transition-all active:scale-[0.98]">
                                <div className="flex gap-4">
                                    <div className="w-24 h-24 rounded-2xl bg-surfaceLighter relative overflow-hidden">
                                        <img src={salon.shopImage} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                                        <div className="absolute top-2 right-2 bg-black/60 backdrop-blur-md px-1.5 py-0.5 rounded text-[10px] font-bold text-gold flex items-center gap-1">
                                            <Icon name="star" size={8} fill="currentColor" /> {salon.rating}
                                        </div>
                                    </div>
                                    <div className="flex-1 flex flex-col justify-between py-1">
                                        <div>
                                            <div className="flex justify-between items-start">
                                                <h3 className="font-bold text-white text-lg">{salon.shopName}</h3>
                                                <div className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${salon.status === 'open' ? 'bg-success/10 text-success' : 'bg-danger/10 text-danger'}`}>
                                                    {salon.status}
                                                </div>
                                            </div>
                                            <p className="text-textSec text-xs flex items-center gap-1 mt-1"><Icon name="map-pin" size={12} /> {salon.address}</p>
                                        </div>
                                        <div className="flex items-center gap-4 text-xs text-textTert">
                                            <span className="flex items-center gap-1"><Icon name="clock" size={12}/> 15 min wait</span>
                                            <span className="flex items-center gap-1"><Icon name="navigation" size={12}/> 1.2 km</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                        {salons.length === 0 && (
                            <div className="text-center py-10 text-textSec">
                                <Icon name="map" size={48} className="mx-auto mb-4 opacity-20" />
                                <p>No salons found yet.</p>
                            </div>
                        )}
                    </div>
                 </div>
             );
        };

        const CustomerActivity = ({ user, activeToken, cancelToken }) => {
            return (
                <div className="p-6 pb-24 animate-slide-up">
                    <h2 className="text-xl font-bold text-white mb-6">Your Activity</h2>

                    {activeToken ? (
                        <div className="bg-gradient-to-br from-surfaceLight to-surface border border-gold/30 rounded-[2rem] p-6 relative overflow-hidden shadow-2xl shadow-gold/5">
                            <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-gold to-transparent"></div>
                            
                            <div className="text-center mb-6">
                                <p className="text-xs text-gold uppercase tracking-widest font-bold mb-2">Live Token</p>
                                <h1 className="text-7xl font-black text-white tracking-tighter">{activeToken.tokenNumber}</h1>
                                <p className="text-textSec text-sm mt-1">{activeToken.salonName}</p>
                            </div>

                            <div className="grid grid-cols-2 gap-4 border-t border-white/10 pt-6 mb-6">
                                <div className="text-center border-r border-white/10">
                                    <div className="text-2xl font-bold text-white">3</div>
                                    <div className="text-[10px] text-textSec uppercase">Ahead</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-gold">15m</div>
                                    <div className="text-[10px] text-textSec uppercase">Wait</div>
                                </div>
                            </div>

                            <Button onClick={() => cancelToken(activeToken.id)} variant="danger" className="bg-danger/10 text-danger hover:bg-danger text-sm py-3">Cancel Booking</Button>
                        </div>
                    ) : (
                        <div className="text-center py-20 bg-surfaceLight rounded-3xl border border-white/5 border-dashed">
                            <Icon name="ticket" size={48} className="mx-auto mb-4 text-textSec opacity-30" />
                            <p className="text-textSec mb-4">No active appointments.</p>
                            <Button className="w-auto px-8 py-2 text-sm mx-auto">Find a Salon</Button>
                        </div>
                    )}
                    
                    <h3 className="text-sm font-bold text-white mt-10 mb-4">Past Visits</h3>
                    <div className="space-y-3">
                         {/* Mock History */}
                         <div className="flex justify-between items-center p-4 bg-surfaceLight rounded-2xl border border-white/5 opacity-50">
                             <div className="flex gap-3 items-center">
                                 <div className="w-10 h-10 rounded-full bg-surface border border-white/10 flex items-center justify-center"><Icon name="check" size={16} className="text-success"/></div>
                                 <div>
                                     <h4 className="font-bold text-white text-sm">Royal Cuts</h4>
                                     <p className="text-xs text-textSec">Haircut â€¢ â‚¹250</p>
                                 </div>
                             </div>
                             <span className="text-xs text-textSec">Yesterday</span>
                         </div>
                    </div>
                </div>
            );
        };

        const CustomerProfile = ({ user }) => (
            <div className="p-6 pb-24 animate-slide-up">
                <div className="text-center mb-8">
                    <div className="w-24 h-24 rounded-full border-2 border-gold p-1 mx-auto mb-4">
                        <img src={user.photoURL} className="w-full h-full rounded-full object-cover" />
                    </div>
                    <h2 className="text-xl font-bold text-white">{user.displayName}</h2>
                    <p className="text-sm text-textSec">{user.email}</p>
                </div>

                <div className="space-y-3">
                    <button className="w-full bg-surfaceLight p-4 rounded-2xl border border-white/5 flex justify-between items-center hover:border-gold/30 group">
                        <div className="flex items-center gap-3">
                            <Icon name="wallet" className="text-gold" />
                            <span className="font-bold text-white">Wallet</span>
                        </div>
                        <span className="text-sm text-textSec group-hover:text-white">â‚¹0.00</span>
                    </button>
                    <button className="w-full bg-surfaceLight p-4 rounded-2xl border border-white/5 flex justify-between items-center hover:border-gold/30 group">
                        <div className="flex items-center gap-3">
                            <Icon name="heart" className="text-danger" />
                            <span className="font-bold text-white">Favorites</span>
                        </div>
                        <Icon name="chevron-right" size={16} className="text-textSec" />
                    </button>
                    <button onClick={() => auth.signOut()} className="w-full bg-surfaceLight p-4 rounded-2xl border border-white/5 flex justify-between items-center hover:bg-danger/10 hover:border-danger/30 hover:text-danger transition-colors mt-8">
                        <div className="flex items-center gap-3">
                            <Icon name="log-out" />
                            <span className="font-bold">Log Out</span>
                        </div>
                    </button>
                </div>
            </div>
        );

        // --- MAIN DASHBOARDS ---

        const OwnerDashboard = ({ user }) => {
            const [activeTab, setActiveTab] = useState('home');
            const [salon, setSalon] = useState(null);
            const [queue, setQueue] = useState([]);

            useEffect(() => {
                const unsubSalon = onSnapshot(doc(db, "salons", user.uid), s => {
                    if(s.exists()) setSalon(s.data());
                    else setDoc(doc(db, "salons", user.uid), {
                        shopName: `${user.displayName}'s Salon`,
                        ownerName: user.displayName,
                        status: 'open',
                        revenue: 0,
                        services: [],
                        createdAt: serverTimestamp(),
                        shopImage: "https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=800&q=80",
                        address: "India"
                    });
                });

                const q = query(collection(db, "tokens"), where("salonId", "==", user.uid), where("status", "in", ["waiting", "serving"]));
                const unsubQueue = onSnapshot(q, s => setQueue(s.docs.map(d => ({id:d.id, ...d.data()}))));

                return () => { unsubSalon(); unsubQueue(); }
            }, [user]);

            useEffect(() => lucide.createIcons(), [activeTab, salon, queue]);

            const toggleStatus = async () => updateDoc(doc(db, "salons", user.uid), {status: salon?.status==='open'?'closed':'open'});
            
            const callNext = async () => {
                const next = queue.find(t => t.status === 'waiting');
                if(next) await updateDoc(doc(db, "tokens", next.id), {status: 'serving'});
                const current = queue.find(t => t.status === 'serving');
                if(current) await updateDoc(doc(db, "tokens", current.id), {status: 'completed'});
            };

            return (
                <div className="min-h-screen bg-bg">
                    {activeTab === 'home' && <OwnerHome salon={salon} queue={queue} toggleStatus={toggleStatus} callNext={callNext} />}
                    {activeTab === 'services' && <OwnerServices salon={salon} user={user} />}
                    {activeTab === 'qr' && <OwnerQR user={user} />}
                    {activeTab === 'settings' && <OwnerSettings user={user} salon={salon} />}

                    <BottomNav 
                        activeTab={activeTab} 
                        onTabChange={setActiveTab}
                        tabs={[
                            {id: 'home', label: 'Home', icon: 'layout-grid', fill: true},
                            {id: 'services', label: 'Menu', icon: 'list'},
                            {id: 'qr', label: 'QR', icon: 'qr-code'},
                            {id: 'settings', label: 'Settings', icon: 'settings'}
                        ]} 
                    />
                </div>
            );
        };

        const CustomerDashboard = ({ user }) => {
            const [activeTab, setActiveTab] = useState('home');
            const [salons, setSalons] = useState([]);
            const [activeToken, setActiveToken] = useState(null);

            useEffect(() => {
                const unsubS = onSnapshot(collection(db, "salons"), s => setSalons(s.docs.map(d => ({id:d.id, ...d.data()}))));
                const q = query(collection(db, "tokens"), where("userId", "==", user.uid), where("status", "in", ["waiting", "serving"]));
                const unsubT = onSnapshot(q, s => setActiveToken(!s.empty ? {id:s.docs[0].id, ...s.docs[0].data()} : null));
                return () => { unsubS(); unsubT(); }
            }, [user]);

            useEffect(() => lucide.createIcons(), [activeTab, salons, activeToken]);

            const book = async (salon) => {
                await addDoc(collection(db, "tokens"), {
                    userId: user.uid, userName: user.displayName, salonId: salon.id, salonName: salon.shopName,
                    status: 'waiting', tokenNumber: Math.floor(Math.random() * 99) + 1, createdAt: serverTimestamp()
                });
                setActiveTab('activity');
            };

            const cancel = async (id) => {
                await updateDoc(doc(db, "tokens", id), { status: 'cancelled' });
            };

            return (
                <div className="min-h-screen bg-bg">
                    {activeTab === 'home' && <CustomerHome user={user} salons={salons} onBook={book} />}
                    {activeTab === 'activity' && <CustomerActivity user={user} activeToken={activeToken} cancelToken={cancel} />}
                    {activeTab === 'profile' && <CustomerProfile user={user} />}

                    <BottomNav 
                        activeTab={activeTab} 
                        onTabChange={setActiveTab}
                        tabs={[
                            {id: 'home', label: 'Explore', icon: 'compass', fill: true},
                            {id: 'activity', label: 'Activity', icon: 'ticket'},
                            {id: 'profile', label: 'Profile', icon: 'user', fill: true}
                        ]} 
                    />
                </div>
            );
        };

        // --- ROOT APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState(null);
            const [loading, setLoading] = useState(true);
            const [splash, setSplash] = useState(true);

            useEffect(() => {
                document.getElementById('preloader').style.display = 'none';
                const unsub = onAuthStateChanged(auth, async (u) => {
                    setUser(u);
                    if (u) {
                        const snap = await getDoc(doc(db, "users", u.uid));
                        if (snap.exists()) setRole(snap.data().role);
                    }
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            const handleLogin = () => signInWithPopup(auth, googleProvider);
            const handleRole = async (r) => {
                await setDoc(doc(db, "users", user.uid), { role: r, email: user.email, name: user.displayName, photoURL: user.photoURL, createdAt: serverTimestamp() });
                setRole(r);
            };

            if (splash) return <SplashScreen onFinish={() => setSplash(false)} />;
            if (loading) return null;

            return !user ? <LoginScreen onLogin={handleLogin} /> : 
                   !role ? <RoleSelection onSelect={handleRole} /> : 
                   role === 'owner' ? <OwnerDashboard user={user} /> : <CustomerDashboard user={user} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
