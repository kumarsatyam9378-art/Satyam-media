<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate CricVerse | Login</title>
    <style>
        :root { --primary: #0f0c29; --secondary: #302b63; --accent: #00d4ff; --text: #ffffff; }
        body { background: linear-gradient(to right, var(--primary), var(--secondary)); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        
        /* HEADER */
        header { text-align: center; margin-bottom: 20px; width: 100%; max-width: 600px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .logo h1 { margin: 0; color: var(--accent); letter-spacing: 1px; font-size: 1.5rem; }
        
        /* USER PROFILE (HIDDEN INITIALLY) */
        #user-profile { display: none; align-items: center; gap: 10px; }
        #user-pic { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent); }
        #user-name { font-weight: bold; font-size: 0.9rem; }

        /* SCREENS */
        .screen { width: 100%; max-width: 500px; display: none; animation: fadeIn 0.5s; }
        .active { display: block; }

        /* LOGIN CARD */
        .login-card { background: rgba(255, 255, 255, 0.1); padding: 40px; border-radius: 20px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); margin-top: 50px; }
        
        /* GOOGLE BTN */
        .google-btn { background: white; color: #333; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px 24px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; margin: 20px auto 0; width: 100%; max-width: 250px; }
        .google-btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(255,255,255,0.2); }

        /* GAME CARDS */
        .player-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-top: 20px; }
        .player-card { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.3s ease; }
        .player-card.selected { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
        
        /* GAME CONSOLE */
        .ai-terminal { background: #000; color: #00ff00; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; min-height: 120px; margin-bottom: 15px; border: 1px solid #333; overflow-y: auto; max-height: 200px; text-align: left; }
        .visual-box { width: 100%; height: 250px; background: #111; margin-bottom: 15px; border-radius: 8px; object-fit: cover; display: none; }
        
        .btn { background: var(--accent); color: #000; border: none; padding: 14px; width: 100%; border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        .btn:disabled { background: #555; opacity: 0.6; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <h1>üèè CRICVERSE</h1>
        </div>
        <div id="user-profile">
            <span id="user-name">Player</span>
            <img id="user-pic" src="" alt="Profile">
        </div>
    </header>

    <div id="login-screen" class="screen active">
        <div class="login-card">
            <h2>Welcome to the Arena</h2>
            <p>Login to save your stats and play.</p>
            
            <button id="googleLoginBtn" class="google-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                Sign in with Google
            </button>
        </div>
    </div>

    <div id="lobby-screen" class="screen">
        <h3>Select Your Avatar</h3>
        <div class="player-grid">
            <div class="player-card" id="card-virat">
                <div style="font-size:2rem;">üëë</div>
                <strong>Virat Kohli</strong><br><span style="color:#ffd700">‚Çπ50</span>
            </div>
            <div class="player-card" id="card-rohit">
                <div style="font-size:2rem;">üß¢</div>
                <strong>Rohit Sharma</strong><br><span style="color:#ffd700">‚Çπ40</span>
            </div>
            <div class="player-card" id="card-bumrah">
                <div style="font-size:2rem;">‚ö°</div>
                <strong>J. Bumrah</strong><br><span style="color:#ffd700">‚Çπ30</span>
            </div>
        </div>
        <button id="pay-btn" class="btn" disabled>Select Player First</button>
    </div>

    <div id="game-screen" class="screen">
        <h3>Playing as <span id="active-player" style="color:var(--accent)">...</span></h3>
        <img id="game-visual" class="visual-box">
        <div id="ai-feed" class="ai-terminal">> SYSTEM: Connecting to Stadium...</div>
        <button id="action-btn" class="btn" style="background:#ff0055; color:white;">üèè PLAY NEXT BALL</button>
    </div>

    <script type="module">
        // 1. FIREBASE IMPORTS
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // 2. YOUR CONFIG (Exactly as you provided)
        const firebaseConfig = {
            apiKey: "AIzaSyDXpmQTDZgn_JvtgrEH3tVLzb-XyggLs_M",
            authDomain: "midnight-library-satyam-media.firebaseapp.com",
            projectId: "midnight-library-satyam-media",
            storageBucket: "midnight-library-satyam-media.firebasestorage.app",
            messagingSenderId: "842047619495",
            appId: "1:842047619495:web:7483bc7e4a9029d6dc7682",
            measurementId: "G-CGDLDBT4HH"
        };

        // 3. INITIALIZE FIREBASE
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // 4. AUTH LOGIC
        const loginBtn = document.getElementById("googleLoginBtn");
        
        loginBtn.addEventListener("click", async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert("Login Failed: " + error.message);
            }
        });

        // 5. AUTH STATE LISTENER (Auto-Redirect)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is logged in
                console.log("Logged in as:", user.displayName);
                
                // Update UI Header
                document.getElementById("user-name").innerText = user.displayName.split(" ")[0]; // First Name
                document.getElementById("user-pic").src = user.photoURL;
                document.getElementById("user-profile").style.display = "flex";

                // Switch Screens
                showScreen("lobby-screen");
            } else {
                // User is logged out
                showScreen("login-screen");
            }
        });

        // Helper to switch screens
        function showScreen(screenId) {
            document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
            document.getElementById(screenId).classList.add("active");
        }

        // --- GAME LOGIC START ---
        
        let gameState = { player: "", price: 0, role: "", ball: 0 };
        const UPI_ID = "kumarsatyam9378@okhdfcbank";

        // Player Selection Logic
        document.getElementById("card-virat").onclick = () => selectPlayer("Virat Kohli", 50, "Batter", "card-virat");
        document.getElementById("card-rohit").onclick = () => selectPlayer("Rohit Sharma", 40, "Batter", "card-rohit");
        document.getElementById("card-bumrah").onclick = () => selectPlayer("Jasprit Bumrah", 30, "Bowler", "card-bumrah");

        function selectPlayer(name, price, role, id) {
            gameState = { player: name, price: price, role: role, ball: 0 };
            
            // Visual Selection
            document.querySelectorAll(".player-card").forEach(c => c.classList.remove("selected"));
            document.getElementById(id).classList.add("selected");

            // Enable Pay Button
            const btn = document.getElementById("pay-btn");
            btn.innerText = `PAY ‚Çπ${price} & PLAY`;
            btn.disabled = false;
        }

        // Fake Payment Logic
        document.getElementById("pay-btn").onclick = () => {
            if(confirm(`Confirm payment of ‚Çπ${gameState.price}?`)) {
                showScreen("game-screen");
                document.getElementById("active-player").innerText = gameState.player;
            }
        };

        // AI Game Logic (Pollinations)
        const actionBtn = document.getElementById("action-btn");
        const aiFeed = document.getElementById("ai-feed");
        const gameVisual = document.getElementById("game-visual");

        actionBtn.onclick = async () => {
            actionBtn.disabled = true;
            actionBtn.innerText = "Generating...";
            gameState.ball++;

            const promptText = `Cricket commentary in Hindi. ${gameState.player} is ${gameState.role === 'Batter' ? 'batting' : 'bowling'}. Ball number ${gameState.ball}. Result is exciting. Short 2 lines.`;
            const promptImg = `Cricket stadium, ${gameState.player} close up action shot, 4k realistic`;

            try {
                // Fetch Text & Image Parallel
                const [txtRes, imgRes] = await Promise.all([
                    fetch(`https://pollinations.ai/api/text?prompt=${encodeURIComponent(promptText)}`).then(r=>r.text()),
                    fetch(`https://pollinations.ai/p/${encodeURIComponent(promptImg)}?width=400&height=250&seed=${Math.random()}`).then(r=>r.blob())
                ]);

                // Update UI
                aiFeed.innerHTML += `<br><br>> <b>Ball ${gameState.ball}:</b> ${txtRes}`;
                aiFeed.scrollTop = aiFeed.scrollHeight;
                
                gameVisual.src = URL.createObjectURL(imgRes);
                gameVisual.style.display = "block";

            } catch (e) {
                console.error(e);
            }

            actionBtn.disabled = false;
            actionBtn.innerText = "üèè PLAY NEXT BALL";
        };

    </script>
</body>
</html>
