<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Line Free - Smart Salon Token System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #000000;
            font-family: 'Inter', sans-serif;
            color: #ffffff;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Gold Gradient Text */
        .text-gold-gradient {
            background: linear-gradient(to right, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Gold Borders & Glows */
        .border-gold {
            border-color: #D4AF37;
        }
        .shadow-gold {
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        .shadow-gold-lg {
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }
        .bg-gold-gradient {
            background: linear-gradient(135deg, #D4AF37 0%, #AA771C 100%);
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }

        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
            50% { box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); }
        }
        .animate-pulse-gold { animation: pulse-gold 3s infinite; }

        /* Scrollbar Hiding */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Glassmorphism */
        .glass {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDoc,
            setDoc, 
            addDoc, 
            onSnapshot, 
            query, 
            where, 
            orderBy, 
            updateDoc, 
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBYJq8T7hMP3OsZ0PYqkWe-dDCWB8_b0Ck",
            authDomain: "line-free-4bb96.firebaseapp.com",
            projectId: "line-free-4bb96",
            storageBucket: "line-free-4bb96.firebasestorage.app",
            messagingSenderId: "137966607796",
            appId: "1:137966607796:web:bc84b4884650911d9ea6e1",
            measurementId: "G-6Z6YQ8Z6CC"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        const { useState, useEffect } = React;

        // --- ICONS (Inline SVGs for reliability) ---
        const Icon = ({ path, className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Scissors: (props) => <Icon path={<><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></>} {...props} />,
            User: (props) => <Icon path={<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} {...props} />,
            Store: (props) => <Icon path={<><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></>} {...props} />,
            Google: (props) => (
                <svg className={props.className} width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
            ),
            Clock: (props) => <Icon path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} {...props} />,
            MapPin: (props) => <Icon path={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>} {...props} />,
            LogOut: (props) => <Icon path={<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>} {...props} />,
            Trash2: (props) => <Icon path={<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>} {...props} />,
            CheckCircle: (props) => <Icon path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} {...props} />,
            XCircle: (props) => <Icon path={<><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></>} {...props} />,
            Menu: (props) => <Icon path={<><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></>} {...props} />,
            Smartphone: (props) => <Icon path={<><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></>} {...props} />,
            Coffee: (props) => <Icon path={<><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></>} {...props} />
        };

        // --- COMPONENTS ---

        const SplashScreen = ({ onFinish }) => {
            useEffect(() => {
                const timer = setTimeout(onFinish, 2500);
                return () => clearTimeout(timer);
            }, [onFinish]);

            return (
                <div className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-1000">
                    <div className="relative animate-bounce-slow">
                        <div className="w-32 h-32 rounded-full border-4 border-[#D4AF37] flex items-center justify-center shadow-gold-lg bg-black">
                            <div className="flex flex-col items-center">
                                <div className="w-16 h-16 relative overflow-hidden rounded-full border-2 border-white/10 bg-gradient-to-br from-red-600 via-white to-blue-600 rotate-45 animate-spin-slow" style={{animationDuration: '3s'}}></div>
                                <Icons.Scissors className="absolute text-[#D4AF37] w-12 h-12 mt-1" />
                            </div>
                        </div>
                    </div>
                    <h1 className="mt-6 text-5xl font-bold tracking-widest text-gold-gradient font-[Playfair_Display]">
                        LINE FREE
                    </h1>
                    <p className="mt-2 text-sm text-[#D4AF37] tracking-[0.3em] uppercase opacity-80">Smart Salon Token System</p>
                </div>
            );
        };

        const RoleSelection = ({ onSelect }) => (
            <div className="min-h-screen bg-black p-6 flex flex-col justify-center relative overflow-hidden">
                <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,_rgba(212,175,55,0.15),_transparent_70%)] pointer-events-none"></div>
                
                <h2 className="text-3xl font-bold text-center mb-2 text-white font-[Playfair_Display]">Choose Your Path</h2>
                <p className="text-center text-gray-400 mb-10 text-sm">Experience the future of queue management</p>
                
                <div className="space-y-6 max-w-md mx-auto w-full z-10">
                    <button onClick={() => onSelect('customer')} className="group relative w-full p-8 rounded-2xl glass border border-gray-800 hover:border-[#D4AF37] hover:shadow-gold transition-all duration-300 text-left overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500">
                            <Icons.User size={100} color="#D4AF37" />
                        </div>
                        <Icons.User className="mb-4 w-10 h-10 text-[#D4AF37]" />
                        <h3 className="text-2xl font-bold text-white mb-1">Customer</h3>
                        <p className="text-gray-400 text-sm">Join queues remotely & track live status.</p>
                    </button>

                    <button onClick={() => onSelect('owner')} className="group relative w-full p-8 rounded-2xl glass border border-gray-800 hover:border-[#D4AF37] hover:shadow-gold transition-all duration-300 text-left overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500">
                            <Icons.Store size={100} color="#D4AF37" />
                        </div>
                        <Icons.Store className="mb-4 w-10 h-10 text-[#D4AF37]" />
                        <h3 className="text-2xl font-bold text-white mb-1">Salon Owner</h3>
                        <p className="text-gray-400 text-sm">Manage your shop, services & customers.</p>
                    </button>
                </div>
            </div>
        );

        const GoogleLoginScreen = ({ role, onBack }) => {
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleGoogleLogin = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const result = await signInWithPopup(auth, googleProvider);
                    const user = result.user;
                    
                    // Check if user exists, if not create with selected role
                    const userRef = doc(db, "users", user.uid);
                    const userSnap = await getDoc(userRef);

                    if (!userSnap.exists()) {
                        await setDoc(userRef, {
                            name: user.displayName,
                            email: user.email,
                            role: role,
                            photoURL: user.photoURL,
                            createdAt: serverTimestamp()
                        });

                        // Initialize Salon if Owner
                        if (role === 'owner') {
                             await setDoc(doc(db, "salons", user.uid), {
                                ownerName: user.displayName,
                                salonName: `${user.displayName}'s Salon`,
                                status: 'closed',
                                currentToken: 0,
                                location: 'Unknown',
                                services: [],
                                breakDuration: 0,
                                photoURL: user.photoURL
                            });
                        }
                    }
                    // If exists, Auth listener in App component will handle navigation
                } catch (err) {
                    console.error(err);
                    setError("Login Failed. Please try again.");
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-black flex items-center justify-center p-6 relative">
                    <button onClick={onBack} className="absolute top-6 left-6 text-gray-400 hover:text-white flex items-center gap-2">
                        ← Back
                    </button>

                    <div className="w-full max-w-md glass p-8 rounded-2xl border border-gray-800 shadow-2xl text-center">
                        <div className="mb-8">
                             <div className="w-20 h-20 mx-auto rounded-full bg-black border-2 border-[#D4AF37] flex items-center justify-center mb-4 shadow-gold animate-pulse-gold">
                                 {role === 'customer' ? <Icons.User size={40} className="text-[#D4AF37]" /> : <Icons.Store size={40} className="text-[#D4AF37]" />}
                             </div>
                             <h2 className="text-2xl font-bold text-white mb-2">Welcome, {role === 'owner' ? 'Partner' : 'Customer'}</h2>
                             <p className="text-gray-400 text-sm">Sign in to access your dashboard</p>
                        </div>

                        {error && <div className="mb-4 p-3 bg-red-900/30 border border-red-800 rounded text-red-200 text-sm">{error}</div>}

                        <button 
                            onClick={handleGoogleLogin}
                            disabled={isLoading}
                            className="w-full bg-white text-black font-bold py-4 rounded-xl hover:bg-gray-100 transition-all flex items-center justify-center gap-3 shadow-lg active:scale-95"
                        >
                            {isLoading ? (
                                <div className="w-6 h-6 border-2 border-black border-t-transparent rounded-full animate-spin"></div>
                            ) : (
                                <>
                                    <Icons.Google size={24} />
                                    <span>Continue with Google</span>
                                </>
                            )}
                        </button>
                        
                        <p className="mt-6 text-xs text-gray-500">
                            By continuing, you agree to Line Free's Terms & Privacy Policy.
                        </p>
                    </div>
                </div>
            );
        };

        const CustomerDashboard = ({ user }) => {
            const [salons, setSalons] = useState([]);
            const [selectedSalon, setSelectedSalon] = useState(null);
            const [myToken, setMyToken] = useState(null);
            const [selectedServices, setSelectedServices] = useState([]);
            const [activeTab, setActiveTab] = useState('list');

            // Listen to Salons
            useEffect(() => {
                const q = query(collection(db, "salons"));
                const unsub = onSnapshot(q, (snap) => {
                    setSalons(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                });
                return () => unsub();
            }, []);

            // Listen to My Token
            useEffect(() => {
                const q = query(collection(db, "tokens"), where("userId", "==", user.uid), where("status", "in", ["waiting", "serving"]));
                const unsub = onSnapshot(q, (snap) => {
                    if (!snap.empty) {
                        setMyToken({ id: snap.docs[0].id, ...snap.docs[0].data() });
                        setActiveTab('token');
                    } else {
                        setMyToken(null);
                    }
                });
                return () => unsub();
            }, [user]);

            const handleGetToken = async () => {
                if (!selectedSalon || selectedServices.length === 0) return;
                const totalTime = selectedServices.reduce((acc, curr) => acc + parseInt(curr.time), 0);
                
                await addDoc(collection(db, "tokens"), {
                    userId: user.uid,
                    userName: user.displayName,
                    salonId: selectedSalon.id,
                    services: selectedServices,
                    totalDuration: totalTime,
                    status: "waiting",
                    createdAt: serverTimestamp(),
                    tokenNumber: (selectedSalon.queueLength || 0) + (selectedSalon.currentToken || 0) + 1
                });
                setSelectedSalon(null);
                setSelectedServices([]);
            };

            const toggleService = (s) => {
                if (selectedServices.find(srv => srv.name === s.name)) {
                    setSelectedServices(selectedServices.filter(srv => srv.name !== s.name));
                } else {
                    setSelectedServices([...selectedServices, s]);
                }
            };

            return (
                <div className="min-h-screen bg-black pb-24">
                    {/* Navbar */}
                    <div className="sticky top-0 z-30 bg-black/80 backdrop-blur-md border-b border-gray-800 p-4 flex justify-between items-center">
                        <h1 className="text-xl font-bold text-gold-gradient font-[Playfair_Display]">LINE FREE</h1>
                        <div className="w-8 h-8 rounded-full border border-[#D4AF37] overflow-hidden">
                            <img src={user.photoURL || `https://ui-avatars.com/api/?name=${user.displayName}`} alt="User" />
                        </div>
                    </div>

                    <div className="p-4">
                        {activeTab === 'token' && myToken ? (
                            <div className="animate-fade-in pt-6">
                                <div className="text-center mb-8">
                                    <div className="inline-block px-4 py-1 rounded-full bg-[#D4AF37]/20 border border-[#D4AF37] text-[#D4AF37] text-xs font-bold uppercase tracking-widest mb-4">Live Status</div>
                                    <h2 className="text-6xl font-black text-white mb-2 tracking-tighter">#{myToken.tokenNumber}</h2>
                                    <p className="text-gray-400 text-sm">Your Token Number</p>
                                </div>

                                <div className="glass rounded-3xl p-6 border border-gray-800 relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#D4AF37] to-transparent"></div>
                                    <div className="grid grid-cols-2 gap-4 text-center">
                                        <div className="p-4 bg-white/5 rounded-2xl">
                                            <div className="text-3xl font-bold text-white mb-1">{myToken.status === 'serving' ? 'NOW' : '3'}</div>
                                            <div className="text-[10px] text-gray-500 uppercase tracking-widest">Ahead</div>
                                        </div>
                                        <div className="p-4 bg-white/5 rounded-2xl">
                                            <div className="text-3xl font-bold text-[#D4AF37] mb-1">{myToken.status === 'serving' ? '0' : '45'}</div>
                                            <div className="text-[10px] text-gray-500 uppercase tracking-widest">Mins</div>
                                        </div>
                                    </div>
                                    <button onClick={() => updateDoc(doc(db, "tokens", myToken.id), { status: 'cancelled' })} className="w-full mt-6 py-4 rounded-xl border border-red-900/50 text-red-500 font-medium hover:bg-red-900/10">Cancel Token</button>
                                </div>
                            </div>
                        ) : (
                            <div className="animate-fade-in">
                                <div className="flex gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide">
                                    <button className="px-6 py-2 rounded-full bg-gold-gradient text-black font-bold whitespace-nowrap shadow-gold">Nearby Salons</button>
                                    <button className="px-6 py-2 rounded-full glass text-gray-400 whitespace-nowrap border border-gray-800">Favorites</button>
                                </div>

                                <div className="space-y-4">
                                    {salons.map(salon => (
                                        <div key={salon.id} onClick={() => setSelectedSalon(salon)} className="glass p-5 rounded-2xl border border-gray-800 active:scale-95 transition-transform cursor-pointer">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h3 className="text-lg font-bold text-white">{salon.salonName}</h3>
                                                    <div className="flex items-center text-xs text-gray-400 mt-1"><Icons.MapPin size={12} className="mr-1"/> {salon.location}</div>
                                                </div>
                                                <span className={`px-2 py-1 rounded text-[10px] font-bold uppercase border ${salon.status === 'open' ? 'bg-green-900/20 text-green-400 border-green-800' : 'bg-red-900/20 text-red-400 border-red-800'}`}>{salon.status}</span>
                                            </div>
                                            {salon.status === 'open' && (
                                                <div className="flex items-center gap-4 text-xs font-medium">
                                                    <span className="text-[#D4AF37] flex items-center gap-1"><Icons.Clock size={14}/> ~30 mins</span>
                                                    <span className="text-gray-500 flex items-center gap-1"><Icons.User size={14}/> 5 waiting</span>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Booking Modal */}
                    {selectedSalon && (
                        <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
                            <div className="w-full max-w-md glass rounded-3xl p-6 border border-[#D4AF37]/30 animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h2 className="text-xl font-bold text-white">{selectedSalon.salonName}</h2>
                                        <p className="text-xs text-[#D4AF37]">Select Services</p>
                                    </div>
                                    <button onClick={() => setSelectedSalon(null)}><Icons.XCircle className="text-gray-500" /></button>
                                </div>
                                <div className="max-h-60 overflow-y-auto space-y-2 pr-2 mb-6">
                                    {selectedSalon.services?.map(s => (
                                        <div key={s.name} onClick={() => toggleService(s)} className={`p-4 rounded-xl border flex justify-between items-center cursor-pointer ${selectedServices.find(i=>i.name===s.name) ? 'bg-[#D4AF37]/20 border-[#D4AF37] text-white' : 'bg-black/40 border-gray-800 text-gray-400'}`}>
                                            <div>
                                                <div className="font-bold">{s.name}</div>
                                                <div className="text-xs opacity-60">{s.time} min • ₹{s.price}</div>
                                            </div>
                                            {selectedServices.find(i=>i.name===s.name) && <Icons.CheckCircle size={18} className="text-[#D4AF37]"/>}
                                        </div>
                                    ))}
                                </div>
                                <button onClick={handleGetToken} disabled={selectedServices.length === 0} className={`w-full py-4 rounded-xl font-bold text-black uppercase tracking-wider ${selectedServices.length > 0 ? 'bg-gold-gradient shadow-gold' : 'bg-gray-800 text-gray-500'}`}>Get Token</button>
                            </div>
                        </div>
                    )}

                    {/* Tab Bar */}
                    <div className="fixed bottom-0 w-full bg-black/90 backdrop-blur-lg border-t border-gray-800 p-4 flex justify-around pb-6">
                        <button onClick={() => setActiveTab('list')} className={`flex flex-col items-center ${activeTab === 'list' ? 'text-[#D4AF37]' : 'text-gray-600'}`}>
                            <Icons.Store size={22} />
                            <span className="text-[10px] mt-1 font-bold">Salons</span>
                        </button>
                        <button onClick={() => setActiveTab('token')} className={`flex flex-col items-center ${activeTab === 'token' ? 'text-[#D4AF37]' : 'text-gray-600'}`}>
                            <Icons.Smartphone size={22} />
                            <span className="text-[10px] mt-1 font-bold">My Token</span>
                        </button>
                        <button onClick={() => auth.signOut()} className="flex flex-col items-center text-gray-600">
                            <Icons.LogOut size={22} />
                            <span className="text-[10px] mt-1 font-bold">Logout</span>
                        </button>
                    </div>
                </div>
            );
        };

        const OwnerDashboard = ({ user }) => {
            const [salon, setSalon] = useState(null);
            const [tokens, setTokens] = useState([]);
            const [view, setView] = useState('queue');
            const [newSvc, setNewSvc] = useState({ name: '', time: '', price: '' });

            useEffect(() => {
                const unsubSalon = onSnapshot(doc(db, "salons", user.uid), s => setSalon(s.data()));
                const q = query(collection(db, "tokens"), where("salonId", "==", user.uid), where("status", "in", ["waiting", "serving"]), orderBy("createdAt"));
                const unsubTokens = onSnapshot(q, s => setTokens(s.docs.map(d => ({id:d.id, ...d.data()}))));
                return () => { unsubSalon(); unsubTokens(); }
            }, [user]);

            const callNext = async () => {
                const serving = tokens.find(t => t.status === 'serving');
                if (serving) await updateDoc(doc(db, "tokens", serving.id), { status: 'completed' });
                const next = tokens.find(t => t.status === 'waiting');
                if (next) await updateDoc(doc(db, "tokens", next.id), { status: 'serving' });
            };

            const addService = async () => {
                if(!newSvc.name) return;
                const services = [...(salon.services||[]), newSvc];
                await updateDoc(doc(db, "salons", user.uid), { services });
                setNewSvc({ name: '', time: '', price: '' });
            };

            if (!salon) return <div className="h-screen bg-black flex items-center justify-center text-[#D4AF37]">Loading...</div>;

            return (
                <div className="min-h-screen bg-black pb-24">
                     <div className="bg-[#111] p-6 rounded-b-3xl border-b border-gray-800 shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-xl font-bold text-white">{salon.salonName}</h1>
                                <p className="text-xs text-gray-500">Partner Dashboard</p>
                            </div>
                            <div className={`px-3 py-1 rounded-full text-xs font-bold uppercase border ${salon.status === 'open' ? 'bg-green-900/20 text-green-400 border-green-800' : 'bg-red-900/20 text-red-400 border-red-800'}`}>{salon.status}</div>
                        </div>
                        <div className="grid grid-cols-3 gap-3">
                            {['open', 'break', 'closed'].map(st => (
                                <button key={st} onClick={() => updateDoc(doc(db, "salons", user.uid), { status: st })} className={`p-3 rounded-xl flex flex-col items-center justify-center font-bold text-[10px] uppercase transition-all ${salon.status === st ? 'bg-gold-gradient text-black shadow-gold' : 'bg-gray-800 text-gray-400'}`}>
                                    {st}
                                </button>
                            ))}
                        </div>
                     </div>

                     <div className="p-4">
                        {view === 'queue' ? (
                            <>
                                <div className="mb-6">
                                    <h2 className="text-gray-500 text-xs font-bold uppercase tracking-widest mb-3">Currently Serving</h2>
                                    <div className="bg-gradient-to-br from-[#D4AF37] to-[#8a6e1d] p-6 rounded-2xl text-black shadow-gold">
                                        {tokens.find(t => t.status === 'serving') ? (
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <span className="text-5xl font-black block">#{tokens.find(t => t.status === 'serving').tokenNumber}</span>
                                                    <span className="font-bold opacity-80">{tokens.find(t => t.status === 'serving').userName}</span>
                                                </div>
                                                <div className="text-right text-xs font-bold uppercase">
                                                    <div>{tokens.find(t => t.status === 'serving').services.map(s=>s.name).join(', ')}</div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-center font-bold opacity-60 py-4">CHAIR EMPTY</div>
                                        )}
                                    </div>
                                    <button onClick={callNext} className="w-full mt-4 bg-gray-800 hover:bg-white hover:text-black text-white font-bold py-4 rounded-xl transition-all border border-gray-700">CALL NEXT CUSTOMER</button>
                                </div>

                                <div>
                                    <h2 className="text-gray-500 text-xs font-bold uppercase tracking-widest mb-3">Waiting Line ({tokens.filter(t=>t.status==='waiting').length})</h2>
                                    <div className="space-y-3">
                                        {tokens.filter(t=>t.status==='waiting').map(t => (
                                            <div key={t.id} className="glass p-4 rounded-xl border border-gray-800 flex justify-between items-center">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-[#D4AF37] font-bold">{t.tokenNumber}</div>
                                                    <div>
                                                        <div className="text-white font-bold">{t.userName}</div>
                                                        <div className="text-xs text-gray-500">{t.services.length} services • {t.totalDuration} min</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="animate-fade-in">
                                <h2 className="text-white font-bold text-xl mb-4">Services Menu</h2>
                                <div className="glass p-4 rounded-xl border border-gray-800 mb-4">
                                    <input placeholder="Service Name" className="w-full bg-black/50 border border-gray-700 rounded p-3 mb-3 text-white" value={newSvc.name} onChange={e=>setNewSvc({...newSvc, name: e.target.value})} />
                                    <div className="flex gap-3 mb-3">
                                        <input placeholder="Time (min)" type="number" className="w-1/2 bg-black/50 border border-gray-700 rounded p-3 text-white" value={newSvc.time} onChange={e=>setNewSvc({...newSvc, time: e.target.value})} />
                                        <input placeholder="Price" type="number" className="w-1/2 bg-black/50 border border-gray-700 rounded p-3 text-white" value={newSvc.price} onChange={e=>setNewSvc({...newSvc, price: e.target.value})} />
                                    </div>
                                    <button onClick={addService} className="w-full bg-[#D4AF37] text-black font-bold py-3 rounded">Add Service</button>
                                </div>
                                <div className="space-y-2">
                                    {salon.services?.map((s,i) => (
                                        <div key={i} className="flex justify-between items-center p-4 bg-white/5 rounded-lg border border-gray-800">
                                            <span className="text-white">{s.name}</span>
                                            <span className="text-gray-500 text-sm">{s.time}m • ₹{s.price}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                     </div>

                     <div className="fixed bottom-0 w-full bg-black/90 backdrop-blur-lg border-t border-gray-800 p-4 flex justify-around pb-6">
                        <button onClick={() => setView('queue')} className={`flex flex-col items-center ${view === 'queue' ? 'text-[#D4AF37]' : 'text-gray-600'}`}>
                            <Icons.User size={22} />
                            <span className="text-[10px] mt-1 font-bold">Queue</span>
                        </button>
                        <button onClick={() => setView('services')} className={`flex flex-col items-center ${view === 'services' ? 'text-[#D4AF37]' : 'text-gray-600'}`}>
                            <Icons.Menu size={22} />
                            <span className="text-[10px] mt-1 font-bold">Menu</span>
                        </button>
                        <button onClick={() => auth.signOut()} className="flex flex-col items-center text-gray-600">
                            <Icons.LogOut size={22} />
                            <span className="text-[10px] mt-1 font-bold">Logout</span>
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [userData, setUserData] = useState(null);
            const [splash, setSplash] = useState(true);
            const [selectedRole, setSelectedRole] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            useEffect(() => {
                const unsubAuth = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setAuthLoading(false);
                });
                return () => unsubAuth();
            }, []);

            useEffect(() => {
                if (user) {
                    const unsubDoc = onSnapshot(doc(db, "users", user.uid), (snapshot) => {
                        if (snapshot.exists()) {
                            setUserData(snapshot.data());
                        }
                    });
                    return () => unsubDoc();
                }
            }, [user]);

            if (splash) return <SplashScreen onFinish={() => setSplash(false)} />;

            if (authLoading) return null;

            if (!user) {
                if (!selectedRole) return <RoleSelection onSelect={setSelectedRole} />;
                return <GoogleLoginScreen role={selectedRole} onBack={() => setSelectedRole(null)} />;
            }

            if (!userData) {
                 return (
                    <div className="h-screen bg-black flex flex-col items-center justify-center gap-4">
                        <div className="w-8 h-8 border-2 border-[#D4AF37] border-t-transparent rounded-full animate-spin"></div>
                        <button onClick={() => auth.signOut()} className="text-xs text-gray-500 hover:text-white underline">
                            Stuck? Click to Logout
                        </button>
                    </div>
                 );
            }

            return userData.role === 'owner' ? <OwnerDashboard user={user} /> : <CustomerDashboard user={user} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
