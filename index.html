<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Library | Ultimate Salon App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        display: ['"Outfit"', 'sans-serif'],
                        body: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        background: '#020617', // Darkest Blue/Black
                        surface: '#0f172a',    // Dark Slate
                        primary: '#7c3aed',    // Violet 600
                        secondary: '#1e293b',  // Slate 800
                        accent: '#f43f5e',     // Rose 500
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1)',
                        'slide-up': 'slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1)',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(40px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        /* Cinematic & Glassmorphism Styles */
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .nav-glass {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .btn-cinematic {
            background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%);
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.4);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-cinematic:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 0 30px rgba(124, 58, 237, 0.6);
        }

        .btn-cinematic::after {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn-cinematic:hover::after { left: 100%; }

        .text-glow { text-shadow: 0 0 20px rgba(124, 58, 237, 0.5); }
        
        /* Smooth Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDXpmQTDZgn_JvtgrEH3tVLzb-XyggLs_M",
            authDomain: "midnight-library-satyam-media.firebaseapp.com",
            projectId: "midnight-library-satyam-media",
            appId: "1:842047619495:web:7483bc7e4a9029d6dc7682"
        };

        // Initialize Firebase safely
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        const { useState, useEffect } = React;

        // --- 2. COMPONENTS ---

        // Icon Component
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- LOGIN SCREEN ---
        const LoginScreen = ({ onLogin }) => {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState("");

            const handleGoogle = async () => {
                setLoading(true);
                try {
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    setError(err.message);
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen w-full flex items-center justify-center relative overflow-hidden">
                    {/* Cinematic Background */}
                    <div className="absolute inset-0">
                        <img src="https://images.unsplash.com/photo-1596462502278-27bfdd403348?q=80&w=2000&auto=format&fit=crop" className="w-full h-full object-cover opacity-20 scale-105 animate-pulse-slow" />
                        <div className="absolute inset-0 bg-gradient-to-t from-background via-background/90 to-transparent"></div>
                    </div>

                    <div className="relative z-10 glass-panel p-8 rounded-3xl w-full max-w-sm mx-4 text-center border-t border-white/10 animate-slide-up">
                        <div className="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-primary/40 shadow-[0_0_40px_rgba(124,58,237,0.3)]">
                            <Icon name="scissors" size={32} className="text-primary drop-shadow-lg" />
                        </div>
                        
                        <h1 className="text-4xl font-extrabold font-display text-white mb-2 tracking-tight">Midnight<br/><span className="text-primary text-glow">Library</span></h1>
                        <p className="text-slate-400 mb-8 font-light tracking-wide">Premium Salon Experience</p>

                        {error && <div className="bg-red-500/10 border border-red-500/20 text-red-400 p-3 rounded-lg text-xs mb-4">{error}</div>}

                        <button 
                            onClick={handleGoogle} 
                            disabled={loading}
                            className="w-full bg-white hover:bg-slate-200 text-slate-900 font-bold py-4 rounded-xl flex items-center justify-center gap-3 transition-all transform active:scale-95 shadow-xl"
                        >
                            {loading ? <Icon name="loader-2" className="animate-spin" /> : (
                                <>
                                    <svg className="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                    <span>Continue with Google</span>
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );
        };

        // --- CUSTOMER DASHBOARD ---
        const CustomerView = ({ user }) => {
            const [tab, setTab] = useState('home');
            const [selectedSalon, setSelectedSalon] = useState(null);
            const [myToken, setMyToken] = useState(null);

            // Mock Data
            const salons = [
                { id: 1, name: "Noir & Co.", loc: "Bandra West", wait: 25, rating: 4.8, img: "https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=600&q=80" },
                { id: 2, name: "The Gentleman's Den", loc: "Colaba", wait: 10, rating: 4.5, img: "https://images.unsplash.com/photo-1503951914875-452162b7f30a?w=600&q=80" },
                { id: 3, name: "Luxe Spa", loc: "Juhu", wait: 45, rating: 4.9, img: "https://images.unsplash.com/photo-1633681926022-84c23e8cb2d6?w=600&q=80" },
            ];

            const services = [
                { id: 1, name: "Signature Haircut", price: 650, time: "45m" },
                { id: 2, name: "Beard Sculpting", price: 350, time: "30m" },
                { id: 3, name: "Charcoal Facial", price: 1200, time: "60m" },
            ];

            const handleBook = () => {
                setMyToken({ id: "#TK-889", salon: selectedSalon.name, service: "Signature Haircut", wait: selectedSalon.wait + 10 });
                setSelectedSalon(null);
                setTab('tokens');
            };

            return (
                <div className="pb-24 animate-fade-in">
                    {/* Header */}
                    <div className="sticky top-0 z-40 glass-panel border-b-0 px-6 py-4 flex justify-between items-center">
                        <div>
                            <p className="text-xs text-slate-400 font-medium uppercase tracking-wider">Hello,</p>
                            <h2 className="text-xl font-bold font-display text-white">{user.displayName.split(' ')[0]}</h2>
                        </div>
                        <img src={user.photoURL} className="w-10 h-10 rounded-full border-2 border-primary/50" />
                    </div>

                    <div className="p-4 space-y-6">
                        {/* HOME TAB */}
                        {tab === 'home' && !selectedSalon && (
                            <>
                                <div className="relative">
                                    <input type="text" placeholder="Search for luxury..." className="w-full bg-secondary/50 border border-white/10 rounded-2xl py-3.5 pl-11 pr-4 text-white focus:outline-none focus:border-primary/50 transition-all placeholder:text-slate-600" />
                                    <div className="absolute left-4 top-4 text-slate-500"><Icon name="search" size={18} /></div>
                                </div>

                                <div className="space-y-5">
                                    {salons.map(s => (
                                        <div key={s.id} onClick={() => setSelectedSalon(s)} className="group relative rounded-3xl overflow-hidden cursor-pointer active:scale-95 transition-transform duration-300">
                                            <div className="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent z-10"></div>
                                            <img src={s.img} className="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-700" />
                                            <div className="absolute bottom-0 left-0 right-0 p-5 z-20">
                                                <div className="flex justify-between items-end">
                                                    <div>
                                                        <h3 className="text-2xl font-bold font-display text-white">{s.name}</h3>
                                                        <p className="text-slate-300 text-sm flex items-center gap-1"><Icon name="map-pin" size={12} /> {s.loc}</p>
                                                    </div>
                                                    <div className="bg-white/10 backdrop-blur-md px-3 py-1 rounded-lg border border-white/10">
                                                        <span className="text-xs text-slate-300 block">WAIT</span>
                                                        <span className="text-lg font-bold text-accent">{s.wait}m</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {/* SALON DETAIL */}
                        {selectedSalon && (
                            <div className="animate-slide-up">
                                <button onClick={() => setSelectedSalon(null)} className="flex items-center text-slate-400 mb-4 hover:text-white"><Icon name="arrow-left" size={16} className="mr-1"/> Back</button>
                                
                                <div className="glass-panel p-6 rounded-3xl mb-6 text-center relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-accent"></div>
                                    <h2 className="text-3xl font-bold font-display text-white mb-1">{selectedSalon.name}</h2>
                                    <p className="text-slate-400 text-sm mb-6">{selectedSalon.loc} • ⭐ {selectedSalon.rating}</p>
                                    
                                    <div className="grid grid-cols-3 gap-3 mb-6">
                                        <div className="bg-white/5 p-3 rounded-xl border border-white/5"><div className="text-xl font-bold text-white">08</div><div className="text-[10px] text-slate-500 uppercase">Token</div></div>
                                        <div className="bg-white/5 p-3 rounded-xl border border-white/5"><div className="text-xl font-bold text-white">12</div><div className="text-[10px] text-slate-500 uppercase">Queue</div></div>
                                        <div className="bg-white/5 p-3 rounded-xl border border-white/5"><div className="text-xl font-bold text-accent">{selectedSalon.wait}m</div><div className="text-[10px] text-slate-500 uppercase">Wait</div></div>
                                    </div>

                                    <div className="text-left space-y-3 mb-8">
                                        <p className="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Select Service</p>
                                        {services.map(srv => (
                                            <div key={srv.id} className="flex justify-between items-center p-4 rounded-xl bg-white/5 border border-white/5 hover:border-primary/50 cursor-pointer transition-colors">
                                                <div>
                                                    <div className="font-semibold text-white">{srv.name}</div>
                                                    <div className="text-xs text-slate-500">{srv.time}</div>
                                                </div>
                                                <div className="text-primary font-bold">₹{srv.price}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <button onClick={handleBook} className="w-full btn-cinematic text-white font-bold py-4 rounded-xl shadow-lg">
                                        Join Queue Instantly
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* TOKENS TAB */}
                        {tab === 'tokens' && (
                            <div className="animate-slide-up h-[70vh] flex flex-col justify-center">
                                {myToken ? (
                                    <div className="relative group">
                                        <div className="absolute inset-0 bg-gradient-to-r from-primary to-purple-600 rounded-[32px] blur-xl opacity-40 group-hover:opacity-60 transition-opacity"></div>
                                        <div className="relative glass-panel border border-white/10 rounded-[30px] p-8 text-center overflow-hidden">
                                            <div className="absolute top-0 left-0 right-0 h-32 bg-gradient-to-b from-primary/10 to-transparent"></div>
                                            
                                            <div className="relative z-10">
                                                <p className="text-xs font-bold text-primary uppercase tracking-[0.2em] mb-4">Live Token</p>
                                                <h1 className="text-6xl font-black font-display text-white mb-2 tracking-tighter text-glow">{myToken.id}</h1>
                                                <p className="text-slate-300 text-lg mb-8">{myToken.salon}</p>
                                                
                                                <div className="bg-black/30 p-4 rounded-2xl mb-6 backdrop-blur-md border border-white/5">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="text-slate-400 text-sm">Service</span>
                                                        <span className="font-medium text-white">{myToken.service}</span>
                                                    </div>
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-slate-400 text-sm">Est. Time</span>
                                                        <span className="font-bold text-accent">{myToken.wait} Mins</span>
                                                    </div>
                                                </div>

                                                <button onClick={() => setMyToken(null)} className="text-sm text-red-400 hover:text-red-300 transition-colors">Cancel Booking</button>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center opacity-40">
                                        <Icon name="ticket" size={48} className="mx-auto mb-4" />
                                        <p>No Active Tokens</p>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Bottom Nav */}
                    <div className="fixed bottom-0 left-0 right-0 nav-glass px-6 py-4 flex justify-around z-50">
                        <button onClick={() => {setTab('home'); setSelectedSalon(null)}} className={`${tab === 'home' ? 'text-primary' : 'text-slate-500'} flex flex-col items-center gap-1 transition-colors`}><Icon name="home" size={24} /><span className="text-[10px] font-medium">Home</span></button>
                        <button onClick={() => setTab('tokens')} className={`${tab === 'tokens' ? 'text-primary' : 'text-slate-500'} flex flex-col items-center gap-1 transition-colors`}><Icon name="ticket" size={24} /><span className="text-[10px] font-medium">Tokens</span></button>
                        <button onClick={() => setTab('profile')} className={`${tab === 'profile' ? 'text-primary' : 'text-slate-500'} flex flex-col items-center gap-1 transition-colors`}><Icon name="user" size={24} /><span className="text-[10px] font-medium">Profile</span></button>
                    </div>
                </div>
            );
        };

        // --- BARBER DASHBOARD ---
        const BarberView = ({ user }) => {
            const [currentToken, setCurrentToken] = useState(101);
            const [queue, setQueue] = useState([
                { id: 102, name: "Arjun K.", service: "Fade Cut", time: "15m" },
                { id: 103, name: "Sameer R.", service: "Beard Trim", time: "30m" },
                { id: 104, name: "Vikram S.", service: "Head Massage", time: "45m" },
            ]);

            const next = () => {
                if(queue.length > 0) {
                    setCurrentToken(queue[0].id);
                    setQueue(queue.slice(1));
                }
            };

            return (
                <div className="p-6 min-h-screen pb-24">
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-2xl font-bold font-display text-white">Workstation</h1>
                        <div className="bg-green-500/20 text-green-400 border border-green-500/30 px-3 py-1 rounded-full text-xs font-bold uppercase animate-pulse">Live</div>
                    </div>

                    {/* BIG CARD */}
                    <div className="glass-panel rounded-[30px] p-8 text-center mb-8 relative overflow-hidden shadow-2xl">
                        <div className="absolute inset-0 bg-gradient-to-b from-primary/20 to-transparent"></div>
                        <p className="relative z-10 text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Serving Now</p>
                        <h1 className="relative z-10 text-8xl font-black font-display text-white mb-2 tracking-tighter">{currentToken}</h1>
                        <p className="relative z-10 text-primary font-medium mb-8">Standard Haircut</p>
                        
                        <button onClick={next} className="relative z-10 w-full btn-cinematic py-4 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-2">
                            <Icon name="check-circle" /> Complete & Next
                        </button>
                    </div>

                    <h3 className="text-slate-400 font-bold uppercase text-xs tracking-wider mb-4 px-2">Up Next ({queue.length})</h3>
                    <div className="space-y-3">
                        {queue.map((q, i) => (
                            <div key={q.id} className="bg-secondary/40 border border-white/5 p-4 rounded-2xl flex items-center justify-between animate-slide-up" style={{animationDelay: `${i * 100}ms`}}>
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 rounded-xl bg-white/5 flex items-center justify-center font-bold text-lg text-white border border-white/5">
                                        {q.id}
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-white text-lg">{q.name}</h4>
                                        <p className="text-xs text-slate-400">{q.service}</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <p className="text-accent font-bold">{q.time}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- MAIN CONTROLLER ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState('customer'); // Toggle for demo
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const sub = auth.onAuthStateChanged(u => {
                    setUser(u);
                    setLoading(false);
                });
                return () => sub();
            }, []);

            if (loading) return <div className="h-screen flex items-center justify-center bg-background"><Icon name="loader-2" className="text-primary animate-spin w-10 h-10" /></div>;

            if (!user) return <LoginScreen onLogin={setUser} />;

            return (
                <div className="max-w-md mx-auto min-h-screen relative border-x border-white/5 shadow-2xl bg-background">
                    {/* Role Toggler (DEMO ONLY) */}
                    <div className="fixed top-20 right-4 z-50">
                        <button onClick={() => setRole(role === 'customer' ? 'barber' : 'customer')} className="w-8 h-8 rounded-full bg-white/10 backdrop-blur border border-white/20 flex items-center justify-center text-white hover:bg-white/20 transition">
                            <Icon name="repeat" size={14} />
                        </button>
                    </div>

                    {role === 'customer' ? <CustomerView user={user} /> : <BarberView user={user} />}

                    {/* Logout for Barber View (since customer has it in profile) */}
                    {role === 'barber' && (
                        <div className="fixed bottom-0 left-0 right-0 nav-glass p-4 flex justify-center z-50">
                            <button onClick={() => auth.signOut()} className="text-red-400 flex items-center gap-2 text-sm font-bold"><Icon name="log-out" size={16}/> Sign Out</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
