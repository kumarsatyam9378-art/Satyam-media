<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Line Free | AI Future Salon</title>
    
    <!-- React & Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                        mono: ['Space Grotesk', 'monospace'],
                    },
                    colors: {
                        brand: { 50: '#f0fdfa', 100: '#ccfbf1', 500: '#14b8a6', 600: '#0d9488', 900: '#134e4a' },
                        dark: { 800: '#1e293b', 900: '#0f172a', 950: '#020617' },
                        gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' }
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        .ticket-notch { width: 24px; height: 24px; background: #f8fafc; border-radius: 50%; position: absolute; bottom: 98px; z-index: 10; }
        .dark .ticket-notch { background: #020617; }
        .notch-l { left: -12px; } .notch-r { right: -12px; }
        .scratch-container { position: relative; width: 100%; height: 160px; border-radius: 1rem; overflow: hidden; }
        
        /* Cyberpunk Glitch effect for Owner */
        .cyber-border { position: relative; }
        .cyber-border::before { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #0d9488, #d97706, #7c3aed); z-index: -1; border-radius: 1rem; opacity: 0.5; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-dark-950 text-slate-900 dark:text-slate-50 font-sans antialiased selection:bg-brand-500 selection:text-white transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- FIREBASE CONFIG (Kept existing) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBYJq8T7hMP3OsZ0PYqkWe-dDCWB8_b0Ck",
            authDomain: "line-free-4bb96.firebaseapp.com",
            projectId: "line-free-4bb96",
            storageBucket: "line-free-4bb96.firebasestorage.app",
            messagingSenderId: "137966607796",
            appId: "1:137966607796:web:bc84b4884650911d9ea6e1"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // --- UTILS & DATA ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const CITIES = ["Mumbai", "Delhi", "Bangalore", "Hyderabad", "Pune"];
        
        const generateSalons = (count = 20) => Array.from({ length: count }, (_, i) => ({
            id: `s_${i}`,
            name: `Studio ${["Aura", "Elite", "Velvet", "Nova"][i%4]} ${i}`,
            location: CITIES[i % CITIES.length],
            rating: (4.0 + Math.random()).toFixed(1),
            image: `https://pollinations.ai/p/luxury%20salon%20interior%20lighting%20${i}?width=400&height=300`,
            queueLength: Math.floor(Math.random() * 8),
            services: [
                { id: 'srv1', name: 'Haircut', price: 300, duration: 30 },
                { id: 'srv2', name: 'Beard Trim', price: 150, duration: 15 }
            ]
        }));

        const MOCK_INVENTORY = [
            { id: '1', name: "L'Oreal Shampoo", stock: 12, par: 5 },
            { id: '2', name: "Gillette Blades", stock: 45, par: 20 },
            { id: '3', name: "Hair Wax (Matte)", stock: 3, par: 8 }, // Low stock
        ];

        // --- CONTEXT ---
        const AppContext = createContext();

        const AppProvider = ({ children }) => {
            const [user, setUser] = useState(JSON.parse(localStorage.getItem('lf_user')) || null);
            const [salons] = useState(generateSalons());
            const [myTokens, setMyTokens] = useState(JSON.parse(localStorage.getItem('lf_tokens')) || []);
            const [favorites, setFavorites] = useState(JSON.parse(localStorage.getItem('lf_favs')) || []);
            const [darkMode, setDarkMode] = useState(true); // Default to Dark for futuristic feel
            const [inventory, setInventory] = useState(MOCK_INVENTORY);
            const [notifications, setNotifications] = useState([]);
            const [musicPlaying, setMusicPlaying] = useState(false);
            const [points, setPoints] = useState(120);
            
            // Audio for ambience
            const audioRef = useRef(new Audio("https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3"));

            useEffect(() => {
                document.documentElement.classList.toggle('dark', darkMode);
                localStorage.setItem('lf_dark', JSON.stringify(darkMode));
                if(user) localStorage.setItem('lf_user', JSON.stringify(user));
                else localStorage.removeItem('lf_user');
                localStorage.setItem('lf_tokens', JSON.stringify(myTokens));
                localStorage.setItem('lf_favs', JSON.stringify(favorites));
            }, [darkMode, user, myTokens, favorites]);

            useEffect(() => {
                audioRef.current.loop = true;
                if(musicPlaying) audioRef.current.play().catch(()=>{});
                else audioRef.current.pause();
            }, [musicPlaying]);

            const notify = (msg, type = 'info') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== id)), 4000);
            };

            const googleLogin = async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    const res = await auth.signInWithPopup(provider);
                    return { name: res.user.displayName, email: res.user.email, photo: res.user.photoURL, uid: res.user.uid };
                } catch (e) { notify(e.message, "error"); return null; }
            };

            const logout = async () => { await auth.signOut(); setUser(null); };

            const addToken = (salon, services) => {
                const total = services.reduce((a,b)=>a+b.price, 0);
                const newToken = {
                    id: generateId(),
                    salonName: salon.name,
                    salonLocation: salon.location,
                    tokenNumber: Math.floor(Math.random()*50)+1,
                    estimatedTime: `${services.reduce((a,b)=>a+b.duration,0)} min`,
                    totalPrice: total,
                    serviceNames: services.map(s=>s.name).join(', '),
                    date: new Date().toISOString()
                };
                setMyTokens([...myTokens, newToken]);
                notify("Booking Confirmed!", "success");
            };

            // --- AI FUNCTIONS (PDF FEATURES) ---
            const generateAIText = async (prompt) => {
                try {
                    const res = await fetch(`https://pollinations.ai/api/text?prompt=${encodeURIComponent(prompt)}`);
                    return await res.text();
                } catch (e) {
                    console.error(e);
                    return "AI Offline.";
                }
            };

            const generateAIImageUrl = (prompt) => {
                return `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=800&height=600&seed=${Math.floor(Math.random()*1000)}`;
            };

            return (
                <AppContext.Provider value={{
                    user, setUser, logout, googleLogin,
                    salons, myTokens, setMyTokens, addToken,
                    favorites, setFavorites,
                    darkMode, setDarkMode,
                    inventory, setInventory,
                    notify, notifications,
                    musicPlaying, setMusicPlaying, points,
                    generateAIText, generateAIImageUrl // New AI Exports
                }}>
                    {children}
                </AppContext.Provider>
            );
        };

        // --- ICONS ---
        const Icon = ({ name, size = 20, className }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    const iconName = name.replace(/-([a-z])/g, g => g[1].toUpperCase());
                    const LucideIcon = window.lucide.icons[iconName.charAt(0).toUpperCase() + iconName.slice(1)];
                    if (LucideIcon) {
                        const svg = window.lucide.createElement(LucideIcon);
                        svg.setAttribute('width', size);
                        svg.setAttribute('height', size);
                        if (className) svg.setAttribute('class', className);
                        ref.current.innerHTML = '';
                        ref.current.appendChild(svg);
                    }
                }
            }, [name, size, className]);
            return <span ref={ref} className="inline-flex items-center justify-center"></span>;
        };

        // --- SHARED COMPONENTS ---
        const Button = ({ children, onClick, variant="primary", className="", loading }) => {
            const base = "w-full py-3 rounded-xl font-bold flex items-center justify-center transition-all active:scale-95 disabled:opacity-50";
            const variants = {
                primary: "bg-brand-600 text-white shadow-lg shadow-brand-500/30 hover:bg-brand-700",
                secondary: "bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-white",
                ai: "bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-indigo-500/50"
            };
            return (
                <button onClick={onClick} disabled={loading} className={`${base} ${variants[variant]} ${className}`}>
                    {loading ? <Icon name="loader-2" className="animate-spin" /> : children}
                </button>
            );
        };

        // --------------------------------------------------------------------------------
        // --- SALON OWNER (BARBER) DASHBOARD - HEAVILY UPGRADED ---
        // --------------------------------------------------------------------------------

        const BarberDash = () => {
            const { user, logout, inventory, setInventory, generateAIText, generateAIImageUrl, notify } = useContext(AppContext);
            const [view, setView] = useState('dashboard');
            const [queue, setQueue] = useState([
                {id:1, name:'Amit Sharma', srv:'Haircut', token:5}, 
                {id:2, name:'Raj Patel', srv:'Beard Trim', token:6},
                {id:3, name:'Vikram Singh', srv:'Facial', token:7}
            ]);
            
            // AI States
            const [aiCommentary, setAiCommentary] = useState("");
            const [loadingAI, setLoadingAI] = useState(false);
            const [aiImagePrompt, setAiImagePrompt] = useState("Futuristic cyberpunk barber shop interior neon lights");
            const [generatedImage, setGeneratedImage] = useState(null);
            const [aiTextPrompt, setAiTextPrompt] = useState("");
            const [generatedText, setGeneratedText] = useState("");

            const handleNextCustomer = () => {
                if(queue.length > 0) {
                    notify(`Served Token #${queue[0].token}`);
                    setQueue(prev => prev.slice(1));
                    setAiCommentary(""); 
                }
            };

            const generateCommentary = async () => {
                if(queue.length === 0) return;
                setLoadingAI(true);
                const p = `Generate a short, funny, cricket commentary style announcement for a barber shop customer named ${queue[0].name} who is coming for a ${queue[0].srv}. Be energetic!`;
                const text = await generateAIText(p);
                setAiCommentary(text);
                setLoadingAI(false);
            };

            const handleImageGen = () => {
                setLoadingAI(true);
                // Simulate delay for effect
                setTimeout(() => {
                    setGeneratedImage(generateAIImageUrl(aiImagePrompt));
                    setLoadingAI(false);
                }, 1000);
            };

            const handleTextGen = async () => {
                if(!aiTextPrompt) return;
                setLoadingAI(true);
                const text = await generateAIText(aiTextPrompt);
                setGeneratedText(text);
                setLoadingAI(false);
            };

            return (
                <div className="min-h-screen bg-dark-950 text-white flex flex-col md:flex-row font-mono">
                    {/* Sidebar / Nav */}
                    <div className="w-full md:w-20 lg:w-64 bg-dark-900 border-r border-slate-800 p-4 flex flex-col justify-between z-20">
                        <div>
                            <div className="flex items-center gap-3 mb-8 text-brand-500">
                                <Icon name="scissors" size={30} />
                                <span className="hidden lg:block font-display font-bold text-xl tracking-wider">FUTURE CUTS</span>
                            </div>
                            <nav className="space-y-2">
                                {[
                                    {id:'dashboard', icon:'layout-dashboard', label:'Command Center'},
                                    {id:'ai-studio', icon:'bot', label:'AI Studio (New)'},
                                    {id:'inventory', icon:'package', label:'Inventory'},
                                    {id:'pos', icon:'credit-card', label:'POS Terminal'},
                                ].map(item => (
                                    <button key={item.id} onClick={()=>setView(item.id)} 
                                        className={`w-full p-3 rounded-lg flex items-center gap-3 transition-all ${view===item.id ? 'bg-brand-900/50 text-brand-400 border border-brand-500/30' : 'text-slate-400 hover:bg-slate-800'}`}>
                                        <Icon name={item.icon} />
                                        <span className="hidden lg:block text-sm font-bold">{item.label}</span>
                                    </button>
                                ))}
                            </nav>
                        </div>
                        <button onClick={logout} className="p-3 rounded-lg flex items-center gap-3 text-red-400 hover:bg-red-900/20">
                            <Icon name="log-out" /> <span className="hidden lg:block text-sm">Logout System</span>
                        </button>
                    </div>

                    {/* Main Content Area */}
                    <div className="flex-1 overflow-y-auto relative bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                        
                        {/* VIEW: COMMAND CENTER (Dashboard) */}
                        {view === 'dashboard' && (
                            <div className="p-6 max-w-5xl mx-auto space-y-6">
                                <header className="flex justify-between items-end border-b border-slate-800 pb-4">
                                    <div>
                                        <h1 className="text-4xl font-display font-bold text-white mb-1">Command Center</h1>
                                        <p className="text-slate-400 text-sm">Real-time Operations ‚Ä¢ {new Date().toDateString()}</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-3xl font-bold text-green-400">‚Çπ12,450</div>
                                        <div className="text-xs text-slate-500 uppercase tracking-widest">Today's Revenue</div>
                                    </div>
                                </header>

                                {/* Active Queue & AI Commentary */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Queue Card */}
                                    <div className="bg-dark-900/80 backdrop-blur border border-slate-800 p-6 rounded-2xl cyber-border">
                                        <div className="flex justify-between items-center mb-6">
                                            <h2 className="text-xl font-bold flex items-center gap-2"><Icon name="users" className="text-brand-500"/> Live Queue</h2>
                                            <span className="bg-brand-900 text-brand-400 px-3 py-1 rounded-full text-xs font-bold">{queue.length} Waiting</span>
                                        </div>
                                        
                                        {queue.length > 0 ? (
                                            <div className="text-center py-8">
                                                <div className="text-6xl font-bold text-white mb-2">#{queue[0].token}</div>
                                                <div className="text-2xl font-bold text-brand-400">{queue[0].name}</div>
                                                <div className="text-slate-500 mb-8">{queue[0].srv}</div>
                                                
                                                <div className="grid grid-cols-2 gap-3">
                                                    <Button variant="secondary" onClick={handleNextCustomer}>Next Client</Button>
                                                    <Button variant="ai" onClick={generateCommentary} loading={loadingAI}>
                                                        <Icon name="mic-2" size={18} className="mr-2"/> AI Announce
                                                    </Button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-center py-10 text-slate-500">Queue Empty</div>
                                        )}
                                    </div>

                                    {/* AI Output Screen */}
                                    <div className="bg-black border border-slate-800 p-6 rounded-2xl relative overflow-hidden">
                                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-brand-500 to-transparent opacity-50"></div>
                                        <h2 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                            <div className={`w-2 h-2 rounded-full ${loadingAI?'bg-yellow-400 animate-pulse':'bg-green-500'}`}></div>
                                            System Log / AI Output
                                        </h2>
                                        <div className="h-48 overflow-y-auto font-mono text-sm text-green-400/80 space-y-2">
                                            <p>> System initialized...</p>
                                            <p>> Pollinations API connected...</p>
                                            {loadingAI && <p className="animate-pulse">> Analyzing customer profile...</p>}
                                            {aiCommentary && (
                                                <div className="mt-4 p-3 border border-green-500/30 bg-green-900/10 rounded">
                                                    <span className="text-white font-bold">üì¢ ANNOUNCEMENT:</span><br/>
                                                    "{aiCommentary}"
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: AI STUDIO (New Feature) */}
                        {view === 'ai-studio' && (
                            <div className="p-6 max-w-5xl mx-auto">
                                <h1 className="text-3xl font-display font-bold mb-6 flex items-center gap-3">
                                    <span className="bg-gradient-to-r from-violet-500 to-fuchsia-500 text-transparent bg-clip-text">AI Creative Studio</span>
                                    <span className="text-xs border border-slate-600 px-2 py-0.5 rounded text-slate-400">BETA</span>
                                </h1>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    {/* Text Gen */}
                                    <div className="bg-dark-900 border border-slate-800 p-6 rounded-2xl">
                                        <div className="flex items-center gap-2 mb-4 text-violet-400">
                                            <Icon name="message-square" />
                                            <h2 className="font-bold">Smart Copywriter</h2>
                                        </div>
                                        <p className="text-xs text-slate-500 mb-4">Generate captions, replies, or sms offers.</p>
                                        <textarea 
                                            value={aiTextPrompt}
                                            onChange={e=>setAiTextPrompt(e.target.value)}
                                            className="w-full bg-black border border-slate-700 rounded-xl p-3 text-white text-sm focus:border-violet-500 outline-none mb-4"
                                            rows="3"
                                            placeholder="E.g., Write an Instagram caption for a summer haircut sale..."
                                        ></textarea>
                                        <Button variant="ai" onClick={handleTextGen} loading={loadingAI}>Generate Text</Button>
                                        
                                        {generatedText && (
                                            <div className="mt-4 p-4 bg-slate-800/50 rounded-xl border border-slate-700 text-sm whitespace-pre-wrap">
                                                {generatedText}
                                                <button onClick={()=>{navigator.clipboard.writeText(generatedText); notify("Copied!")}} className="block mt-2 text-xs text-violet-400 hover:text-white">Copy to clipboard</button>
                                            </div>
                                        )}
                                    </div>

                                    {/* Image Gen */}
                                    <div className="bg-dark-900 border border-slate-800 p-6 rounded-2xl">
                                        <div className="flex items-center gap-2 mb-4 text-fuchsia-400">
                                            <Icon name="image" />
                                            <h2 className="font-bold">Visual Generator</h2>
                                        </div>
                                        <p className="text-xs text-slate-500 mb-4">Create posters or interior concepts.</p>
                                        <input 
                                            value={aiImagePrompt}
                                            onChange={e=>setAiImagePrompt(e.target.value)}
                                            className="w-full bg-black border border-slate-700 rounded-xl p-3 text-white text-sm focus:border-fuchsia-500 outline-none mb-4"
                                        />
                                        <Button variant="ai" onClick={handleImageGen} loading={loadingAI}>Generate Art</Button>
                                        
                                        <div className="mt-4 aspect-video bg-black rounded-xl border border-slate-700 flex items-center justify-center overflow-hidden relative group">
                                            {loadingAI ? (
                                                <Icon name="loader-2" className="animate-spin text-slate-600" />
                                            ) : generatedImage ? (
                                                <>
                                                    <img src={generatedImage} className="w-full h-full object-cover" />
                                                    <a href={generatedImage} download target="_blank" className="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">Download</a>
                                                </>
                                            ) : (
                                                <span className="text-slate-700 text-xs">Preview Area</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: INVENTORY */}
                        {view === 'inventory' && (
                            <div className="p-6">
                                <h1 className="text-2xl font-bold mb-6">Inventory Database</h1>
                                <div className="bg-dark-900 border border-slate-800 rounded-xl overflow-hidden">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-800 text-slate-400 uppercase text-xs">
                                            <tr><th className="p-4">Item Name</th><th className="p-4">Stock</th><th className="p-4">Action</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-800">
                                            {inventory.map(item => (
                                                <tr key={item.id}>
                                                    <td className="p-4 font-bold">{item.name}</td>
                                                    <td className="p-4">
                                                        <span className={`px-2 py-1 rounded text-xs ${item.stock<=item.par ? 'bg-red-900 text-red-400':'bg-green-900 text-green-400'}`}>
                                                            {item.stock} Units
                                                        </span>
                                                    </td>
                                                    <td className="p-4 flex gap-2">
                                                        <button onClick={()=>setInventory(prev=>prev.map(i=>i.id===item.id?{...i,stock:i.stock+1}:i))} className="bg-slate-700 p-1 rounded hover:bg-slate-600">+</button>
                                                        <button onClick={()=>setInventory(prev=>prev.map(i=>i.id===item.id?{...i,stock:Math.max(0,i.stock-1)}:i))} className="bg-slate-700 p-1 rounded hover:bg-slate-600">-</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                        
                        {/* VIEW: POS */}
                        {view === 'pos' && (
                            <div className="p-6">
                                <h1 className="text-2xl font-bold mb-6">Point of Sale</h1>
                                <div className="bg-dark-900 border border-slate-800 rounded-2xl p-8 text-center max-w-md mx-auto">
                                    <input type="number" placeholder="Enter Amount" className="w-full bg-black text-4xl text-center font-bold text-white p-4 rounded-xl border border-slate-700 mb-6 focus:border-brand-500 outline-none" />
                                    <Button onClick={()=>notify("Payment Link Sent!", "success")}>Generate UPI QR</Button>
                                    <p className="mt-4 text-xs text-slate-500">Secure Transaction via Stripe/Razorpay</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --------------------------------------------------------------------------------
        // --- CUSTOMER DASHBOARD (UNCHANGED BUT STYLED) ---
        // --------------------------------------------------------------------------------

        const CustomerDash = () => {
            const { user, salons, addToken, myTokens, setMyTokens, favorites, setFavorites, points, logout, musicPlaying, setMusicPlaying, darkMode, setDarkMode } = useContext(AppContext);
            const [view, setView] = useState('home');
            const [selectedSalon, setSelectedSalon] = useState(null);
            const [cart, setCart] = useState([]);
            const [showAR, setShowAR] = useState(false);
            const [searchTerm, setSearch] = useState("");

            // AR Component
            const ARMirror = ({ onClose }) => {
                const videoRef = useRef(null);
                useEffect(() => {
                    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                        if(videoRef.current) videoRef.current.srcObject = stream;
                    }).catch(()=>alert("Camera denied"));
                    return () => { if(videoRef.current?.srcObject) videoRef.current.srcObject.getTracks().forEach(t=>t.stop()); }
                }, []);
                return (
                    <div className="fixed inset-0 z-50 bg-black flex flex-col">
                        <div className="relative flex-1 bg-black">
                            <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover -scale-x-100"></video>
                            <div className="absolute bottom-10 left-0 right-0 flex justify-center gap-4">
                                {['#ef4444', '#eab308', '#3b82f6'].map(c=><div key={c} className="w-12 h-12 rounded-full border-2 border-white" style={{background:c}}></div>)}
                            </div>
                            <button onClick={onClose} className="absolute top-4 left-4 bg-black/50 text-white p-3 rounded-full"><Icon name="x"/></button>
                        </div>
                    </div>
                );
            };

            const book = () => {
                addToken(selectedSalon, cart);
                setCart([]);
                setView('tokens');
            };

            if(showAR) return <ARMirror onClose={()=>setShowAR(false)} />;

            if(view === 'salon' && selectedSalon) {
                return (
                    <div className="min-h-screen bg-slate-50 dark:bg-dark-950 pb-24">
                        <div className="h-64 relative">
                            <img src={selectedSalon.image} className="w-full h-full object-cover" />
                            <div className="absolute inset-0 bg-gradient-to-t from-dark-950 to-transparent"></div>
                            <button onClick={()=>setView('home')} className="absolute top-4 left-4 p-2 bg-black/20 backdrop-blur rounded-full text-white"><Icon name="arrow-left"/></button>
                            <div className="absolute bottom-4 left-4 text-white">
                                <h1 className="text-3xl font-display font-bold">{selectedSalon.name}</h1>
                                <p className="opacity-80 text-sm">{selectedSalon.location} ‚Ä¢ ‚≠ê {selectedSalon.rating}</p>
                            </div>
                        </div>
                        <div className="p-5 space-y-4">
                            <div className="flex gap-3">
                                <div className="flex-1 bg-white dark:bg-dark-900 p-4 rounded-xl border border-slate-100 dark:border-slate-800 text-center">
                                    <div className="text-xs text-slate-400 font-bold uppercase">Queue</div>
                                    <div className="text-xl font-bold dark:text-white">{selectedSalon.queueLength}</div>
                                </div>
                                <div className="flex-1 bg-white dark:bg-dark-900 p-4 rounded-xl border border-slate-100 dark:border-slate-800 text-center">
                                    <div className="text-xs text-slate-400 font-bold uppercase">Wait Time</div>
                                    <div className="text-xl font-bold text-brand-500">~{selectedSalon.queueLength * 15}m</div>
                                </div>
                            </div>
                            <h3 className="font-bold text-lg dark:text-white mt-4">Services</h3>
                            {selectedSalon.services.map(s => {
                                const inCart = cart.find(x=>x.id===s.id);
                                return (
                                    <div key={s.id} onClick={()=>{inCart?setCart(cart.filter(x=>x.id!==s.id)):setCart([...cart,s])}} 
                                        className={`p-4 rounded-xl border flex justify-between items-center cursor-pointer transition-all ${inCart?'border-brand-500 bg-brand-500/10':'border-slate-200 dark:border-slate-800 bg-white dark:bg-dark-900'}`}>
                                        <div><div className="font-bold dark:text-white">{s.name}</div><div className="text-xs text-slate-500">‚Çπ{s.price} ‚Ä¢ {s.duration}m</div></div>
                                        <div className={`w-6 h-6 rounded-full border flex items-center justify-center ${inCart?'bg-brand-500 border-brand-500 text-white':'border-slate-400'}`}>{inCart && <Icon name="check" size={14}/>}</div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="fixed bottom-0 w-full p-4 bg-white/80 dark:bg-dark-950/80 backdrop-blur border-t border-slate-200 dark:border-slate-800">
                            <Button onClick={book} disabled={!cart.length}>{cart.length?`Book (${cart.length}) ‚Ä¢ ‚Çπ${cart.reduce((a,b)=>a+b.price,0)}`:'Select Service'}</Button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 dark:bg-dark-950 pb-20 transition-colors duration-300">
                    <nav className="sticky top-0 bg-white/80 dark:bg-dark-950/80 backdrop-blur border-b border-slate-200 dark:border-slate-800 p-4 flex justify-between items-center z-10">
                        <div className="flex items-center gap-2">
                            <img src={user.photo || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.name}`} className="w-8 h-8 rounded-full border border-slate-300"/>
                            <span className="font-bold dark:text-white">Hi, {user.name.split(' ')[0]}</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={()=>setDarkMode(!darkMode)} className="p-2 rounded-full bg-slate-100 dark:bg-slate-800 dark:text-white"><Icon name={darkMode?'sun':'moon'}/></button>
                        </div>
                    </nav>

                    <div className="p-4 space-y-6">
                        {view === 'home' && (
                            <>
                                {/* AR Promo */}
                                <div onClick={()=>setShowAR(true)} className="relative h-40 rounded-2xl overflow-hidden cursor-pointer group shadow-lg">
                                    <img src="https://images.unsplash.com/photo-1599351431202-6e0000000000?w=800&q=80" className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"/>
                                    <div className="absolute inset-0 bg-black/40 flex flex-col justify-center p-6">
                                        <span className="bg-brand-500 text-white text-[10px] font-bold px-2 py-1 rounded w-fit mb-2">TRY ON AI</span>
                                        <h2 className="text-2xl font-bold text-white">Virtual Mirror</h2>
                                        <p className="text-white/80 text-xs">Test colors before you book.</p>
                                    </div>
                                </div>

                                <div className="relative">
                                    <Icon name="search" className="absolute left-3 top-3 text-slate-400" size={18}/>
                                    <input value={searchTerm} onChange={e=>setSearch(e.target.value)} placeholder="Search salons..." className="w-full pl-10 py-3 rounded-xl bg-white dark:bg-dark-900 border border-slate-200 dark:border-slate-800 dark:text-white focus:outline-none focus:border-brand-500"/>
                                </div>

                                <div className="space-y-3">
                                    {salons.filter(s=>s.name.toLowerCase().includes(searchTerm.toLowerCase())).map(s => (
                                        <div key={s.id} onClick={()=>{setSelectedSalon(s); setView('salon')}} className="flex gap-4 p-3 bg-white dark:bg-dark-900 border border-slate-200 dark:border-slate-800 rounded-xl cursor-pointer hover:border-brand-500 transition-colors">
                                            <img src={s.image} className="w-20 h-20 rounded-lg object-cover bg-slate-200"/>
                                            <div>
                                                <h3 className="font-bold dark:text-white">{s.name}</h3>
                                                <p className="text-xs text-slate-500 mb-2">{s.location}</p>
                                                <div className="flex gap-2 text-[10px] font-bold">
                                                    <span className="bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded">‚òÖ {s.rating}</span>
                                                    <span className="bg-brand-100 text-brand-700 px-1.5 py-0.5 rounded">{s.queueLength} Waiting</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {view === 'tokens' && (
                            <div className="space-y-4">
                                <h2 className="text-xl font-bold dark:text-white">My Tokens</h2>
                                {myTokens.length === 0 ? <p className="text-center text-slate-500 py-10">No active bookings.</p> : 
                                    myTokens.map(t => (
                                        <div key={t.id} className="relative bg-white dark:bg-dark-900 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden">
                                            <div className="p-5 pb-8 border-b-2 border-dashed border-slate-300 dark:border-slate-700">
                                                <h3 className="font-bold text-lg dark:text-white">{t.salonName}</h3>
                                                <p className="text-xs text-slate-500 mb-4">{t.salonLocation}</p>
                                                <div className="flex justify-between items-end">
                                                    <div><div className="text-xs uppercase text-slate-400 font-bold">Token</div><div className="text-4xl font-display font-bold text-brand-500">#{t.tokenNumber}</div></div>
                                                    <div className="text-right"><div className="text-xs uppercase text-slate-400 font-bold">Est. Wait</div><div className="text-xl font-bold dark:text-white">{t.estimatedTime}</div></div>
                                                </div>
                                            </div>
                                            <div className="bg-slate-50 dark:bg-black p-4 flex justify-between items-center">
                                                <div className="text-xs font-mono dark:text-slate-400">ID: {t.id.toUpperCase()}</div>
                                                <button onClick={()=>setMyTokens(myTokens.filter(x=>x.id!==t.id))} className="text-xs text-red-500 font-bold">Cancel</button>
                                            </div>
                                            <div className="ticket-notch notch-l shadow-inner dark:bg-dark-950"></div>
                                            <div className="ticket-notch notch-r shadow-inner dark:bg-dark-950"></div>
                                        </div>
                                    ))
                                }
                            </div>
                        )}

                        {view === 'profile' && (
                            <div className="text-center space-y-6 pt-6">
                                <div className="w-24 h-24 rounded-full border-4 border-white shadow-lg mx-auto overflow-hidden">
                                    <img src={user.photo || `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.name}`} className="w-full h-full object-cover"/>
                                </div>
                                <div><h2 className="text-2xl font-bold dark:text-white">{user.name}</h2><p className="text-slate-500">{user.email}</p></div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-white dark:bg-dark-900 p-4 rounded-xl border border-slate-100 dark:border-slate-800">
                                        <div className="text-xs uppercase text-slate-400 font-bold">Loyalty Pts</div>
                                        <div className="text-2xl font-bold text-gold-500">{points}</div>
                                    </div>
                                    <div className="bg-white dark:bg-dark-900 p-4 rounded-xl border border-slate-100 dark:border-slate-800">
                                        <div className="text-xs uppercase text-slate-400 font-bold">Bookings</div>
                                        <div className="text-2xl font-bold text-brand-500">{myTokens.length}</div>
                                    </div>
                                </div>
                                <Button onClick={()=>setMusicPlaying(!musicPlaying)} variant="secondary" className="gap-2">
                                    <Icon name={musicPlaying?'volume-2':'volume-x'}/> {musicPlaying?'Mute Ambience':'Play Ambience'}
                                </Button>
                                <Button onClick={logout} className="bg-red-50 text-red-500 hover:bg-red-100 dark:bg-red-900/20">Logout</Button>
                            </div>
                        )}
                    </div>

                    <div className="fixed bottom-0 w-full bg-white/90 dark:bg-dark-950/90 backdrop-blur border-t border-slate-200 dark:border-slate-800 flex justify-around p-3 pb-5 z-50">
                        {['home', 'tokens', 'profile'].map(v => (
                            <button key={v} onClick={()=>setView(v)} className={`flex flex-col items-center gap-1 ${view===v?'text-brand-500':'text-slate-400'}`}>
                                <Icon name={v==='home'?'home':v==='tokens'?'ticket':'user'} size={22} className={view===v?'fill-current':''}/>
                                <span className="text-[10px] font-bold uppercase">{v}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- AUTH ---
        const Login = () => {
            const { googleLogin, setUser } = useContext(AppContext);
            const [role, setRole] = useState(null);
            
            const handleLogin = async () => {
                const u = await googleLogin();
                if(u) {
                    if(!role) {
                        alert("Please select a role first!");
                        return;
                    }
                    setUser({...u, role});
                }
            };

            return (
                <div className="min-h-screen bg-dark-950 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1621605815971-fbc98d665033?w=1200&q=80')] bg-cover opacity-20"></div>
                    <div className="relative z-10 w-full max-w-sm bg-black/60 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl text-center">
                        <div className="w-16 h-16 bg-brand-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-brand-500/50">
                            <Icon name="scissors" className="text-white" size={32} />
                        </div>
                        <h1 className="text-4xl font-display font-bold text-white mb-2">Line Free</h1>
                        <p className="text-slate-400 mb-8">The Future of Grooming</p>

                        {!role ? (
                            <div className="space-y-3">
                                <button onClick={()=>setRole('customer')} className="w-full p-4 bg-white/10 hover:bg-white/20 border border-white/10 rounded-xl flex items-center gap-4 text-white transition-all group">
                                    <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center text-green-400"><Icon name="user"/></div>
                                    <div className="text-left"><div className="font-bold">Customer</div><div className="text-xs text-slate-400">Book & Browse</div></div>
                                </button>
                                <button onClick={()=>setRole('barber')} className="w-full p-4 bg-white/10 hover:bg-white/20 border border-white/10 rounded-xl flex items-center gap-4 text-white transition-all group">
                                    <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400"><Icon name="scissors"/></div>
                                    <div className="text-left"><div className="font-bold">Salon Owner</div><div className="text-xs text-slate-400">Manage Business</div></div>
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="text-white text-sm bg-white/10 p-2 rounded-lg inline-flex items-center gap-2">
                                    Joining as <span className="font-bold uppercase text-brand-400">{role}</span> <button onClick={()=>setRole(null)}><Icon name="x" size={14}/></button>
                                </div>
                                <button onClick={handleLogin} className="w-full bg-white text-black font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-200 transition-colors">
                                    <Icon name="log-in" size={18}/> Continue with Google
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const { user } = useContext(AppContext);
            if (!user) return <Login />;
            return user.role === 'barber' ? <BarberDash /> : <CustomerDash />;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<AppProvider><App /></AppProvider>);
    </script>
</body>
</html>

