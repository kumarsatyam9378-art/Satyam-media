<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Library | Ultimate Salon App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        display: ['sans-serif'],
                        body: ['sans-serif'],
                    },
                    colors: {
                        background: '#000000', 
                        surface: '#121212',    
                        primary: '#8b5cf6',    
                        secondary: '#1f2937',  
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        body { background-color: #000; color: #fff; overflow-x: hidden; }
        .glass {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-gradient {
            background: linear-gradient(135deg, #7c3aed, #4f46e5);
            transition: transform 0.2s;
        }
        .btn-gradient:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyDXpmQTDZgn_JvtgrEH3tVLzb-XyggLs_M",
            authDomain: "midnight-library-satyam-media.firebaseapp.com",
            projectId: "midnight-library-satyam-media",
            appId: "1:842047619495:web:7483bc7e4a9029d6dc7682"
        };
        
        // Initialize safely
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        const { useState, useEffect } = React;

        // --- COMPONENTS ---

        const Icon = ({ name, size=24, className="" }) => {
            useEffect(() => { if(window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- LOGIN SCREEN ---
        const LoginScreen = ({ onLogin }) => {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState("");

            // Original Google Login (Works on Server)
            const handleGoogle = async () => {
                setLoading(true);
                try {
                    await auth.signInWithPopup(provider);
                } catch (err) {
                    console.error(err);
                    setError("Google Login failed (File protocol?). Try Guest Mode.");
                    setLoading(false);
                }
            };

            // Guest Bypass (Works Everywhere)
            const handleGuest = () => {
                onLogin({ 
                    displayName: "Guest User", 
                    photoURL: "https://api.dicebear.com/7.x/avataaars/svg?seed=Guest",
                    uid: "guest-123"
                });
            };

            return (
                <div className="h-screen flex items-center justify-center bg-[url('https://images.unsplash.com/photo-1600948836101-f9ffda59d250?w=1600&q=80')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-black/80"></div>
                    
                    <div className="relative glass p-8 rounded-3xl w-full max-w-sm mx-4 text-center animate-fade-in shadow-2xl">
                        <div className="w-20 h-20 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-primary/50">
                            <Icon name="scissors" size={32} className="text-primary" />
                        </div>
                        
                        <h1 className="text-3xl font-bold mb-2">Midnight Library</h1>
                        <p className="text-gray-400 mb-8 text-sm">Premium Booking Experience</p>

                        {error && <div className="bg-red-900/50 text-red-200 text-xs p-2 rounded mb-4">{error}</div>}

                        <button onClick={handleGoogle} disabled={loading} className="w-full bg-white text-black font-bold py-3 rounded-xl mb-3 flex items-center justify-center gap-2 hover:bg-gray-200">
                            {loading ? "Loading..." : "Continue with Google"}
                        </button>

                        <button onClick={handleGuest} className="w-full bg-secondary text-white font-medium py-3 rounded-xl border border-white/10 hover:bg-white/10">
                            Enter as Guest (No Login)
                        </button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home'); // home, queue, barber
            const [activeToken, setActiveToken] = useState(null);

            // Listen for Real Auth
            useEffect(() => {
                auth.onAuthStateChanged(u => {
                    if (u) setUser(u);
                });
            }, []);

            // Handle Login (Guest or Real)
            const handleLogin = (u) => setUser(u);

            // --- UI SECTIONS ---
            if (!user) return <LoginScreen onLogin={handleLogin} />;

            return (
                <div className="max-w-md mx-auto min-h-screen bg-black border-x border-white/10 relative shadow-2xl">
                    
                    {/* TOP BAR */}
                    <div className="p-4 flex justify-between items-center glass sticky top-0 z-50">
                        <div className="flex items-center gap-3">
                            <img src={user.photoURL} className="w-10 h-10 rounded-full border border-primary" />
                            <div>
                                <p className="text-xs text-gray-400">Welcome,</p>
                                <h3 className="font-bold">{user.displayName.split(' ')[0]}</h3>
                            </div>
                        </div>
                        <button onClick={() => setView(view === 'barber' ? 'home' : 'barber')} className="text-xs bg-white/10 px-3 py-1 rounded-full border border-white/20">
                            {view === 'barber' ? 'Switch to Customer' : 'Switch to Barber'}
                        </button>
                    </div>

                    {/* CUSTOMER HOME */}
                    {view === 'home' && (
                        <div className="p-4 space-y-6 animate-fade-in pb-24">
                            <div className="relative">
                                <input className="w-full bg-secondary p-3 pl-10 rounded-xl text-sm border border-white/10 focus:outline-none focus:border-primary" placeholder="Search salons..." />
                                <div className="absolute left-3 top-3 text-gray-400"><Icon name="search" size={18}/></div>
                            </div>

                            {/* SALON CARD */}
                            <div className="glass rounded-2xl overflow-hidden group">
                                <div className="h-40 relative">
                                    <img src="https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=600" className="w-full h-full object-cover opacity-80" />
                                    <div className="absolute top-3 right-3 bg-green-500/20 text-green-400 text-xs px-2 py-1 rounded font-bold backdrop-blur">OPEN</div>
                                </div>
                                <div className="p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <h2 className="text-xl font-bold">Noir Barbershop</h2>
                                        <div className="text-right">
                                            <span className="text-primary font-bold">25m</span>
                                            <p className="text-[10px] text-gray-400 uppercase">Wait</p>
                                        </div>
                                    </div>
                                    <p className="text-gray-400 text-sm mb-4">üìç Bandra West, Mumbai</p>
                                    <button onClick={() => { setActiveToken(88); setView('queue'); }} className="w-full btn-gradient py-3 rounded-xl font-bold">Get Token</button>
                                </div>
                            </div>

                            <div className="glass rounded-2xl overflow-hidden group">
                                <div className="h-40 relative">
                                    <img src="https://images.unsplash.com/photo-1560066984-138dadb4c035?w=600" className="w-full h-full object-cover opacity-80" />
                                </div>
                                <div className="p-4">
                                    <h2 className="text-xl font-bold">Luxe Spa</h2>
                                    <p className="text-gray-400 text-sm mb-4">üìç Juhu, Mumbai</p>
                                    <button onClick={() => { setActiveToken(92); setView('queue'); }} className="w-full bg-secondary py-3 rounded-xl font-bold border border-white/10">Get Token</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* QUEUE PAGE */}
                    {view === 'queue' && (
                        <div className="h-[80vh] flex flex-col items-center justify-center p-6 animate-fade-in text-center">
                            {activeToken ? (
                                <div className="glass w-full p-8 rounded-3xl border border-primary/30 relative overflow-hidden">
                                    <div className="absolute inset-0 bg-primary/10 blur-xl"></div>
                                    <div className="relative z-10">
                                        <p className="text-xs uppercase tracking-widest text-gray-400 mb-2">Your Token</p>
                                        <h1 className="text-8xl font-black text-white mb-2">#{activeToken}</h1>
                                        <p className="text-primary font-medium mb-8">Noir Barbershop</p>
                                        <div className="bg-black/40 p-4 rounded-xl mb-6">
                                            <div className="flex justify-between text-sm"><span>Est. Wait</span><span className="font-bold">25 Mins</span></div>
                                        </div>
                                        <button onClick={() => setActiveToken(null)} className="text-red-400 text-sm hover:text-red-300">Cancel Booking</button>
                                    </div>
                                </div>
                            ) : (
                                <div className="opacity-50">
                                    <Icon name="ticket" size={48} className="mx-auto mb-4"/>
                                    <p>No Active Queue</p>
                                    <button onClick={() => setView('home')} className="mt-4 text-primary font-bold">Find a Salon</button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* BARBER VIEW */}
                    {view === 'barber' && (
                        <div className="p-6 pb-24 animate-fade-in">
                            <div className="glass p-6 rounded-3xl text-center mb-6 border border-primary/20">
                                <p className="text-xs uppercase text-gray-400 mb-2">Serving Now</p>
                                <h1 className="text-7xl font-bold text-white mb-4">102</h1>
                                <button className="w-full btn-gradient py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                                    <Icon name="check"/> Next Customer
                                </button>
                            </div>
                            <h3 className="text-sm font-bold text-gray-400 mb-4 uppercase">Waiting Queue (3)</h3>
                            {[103, 104, 105].map(n => (
                                <div key={n} className="bg-secondary p-4 rounded-xl flex justify-between items-center mb-2 border border-white/5">
                                    <div className="flex items-center gap-4">
                                        <span className="font-bold text-lg">#{n}</span>
                                        <span className="text-sm text-gray-300">Customer Name</span>
                                    </div>
                                    <span className="text-xs text-primary bg-primary/10 px-2 py-1 rounded">~15m</span>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* BOTTOM NAV */}
                    <div className="fixed bottom-0 max-w-md w-full glass flex justify-around p-4 border-t border-white/10 z-50">
                        <button onClick={() => setView('home')} className={view === 'home' ? 'text-primary' : 'text-gray-500'}><Icon name="home" /></button>
                        <button onClick={() => setView('queue')} className={view === 'queue' ? 'text-primary' : 'text-gray-500'}><Icon name="ticket" /></button>
                        <button onClick={() => { setUser(null); auth.signOut(); }} className="text-red-500"><Icon name="log-out" /></button>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
